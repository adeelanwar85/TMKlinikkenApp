(function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c,l){var y=new Date,a=this,v;for(a.selectedTime=n,a.disableCancelation=new Date(n.canCancelBefore)<y,a.disableCancelationcombined=!1,a.disableCancelationSingle=new Date(n.canCancelBefore)<y,a.departmentPreferences=h.getDepartmentPreferences(),a.departmentNouns=h.getDepartmentNouns(),a.screenOptions=c.getScreenOptions(),v=0;v<a.selectedTime.connectedActivities.length;v++)new Date(a.selectedTime.connectedActivities[v].canCancelBefore)<y&&(a.disableCancelationcombined=!0);a.dismissModal=function(){r.dismiss("cancel")};a.removeFutureBooking=function(){a.disableCancelationSingle=!0;t.cancelBooking(n).then(function(){i.success(l.instant("Activity_Cancelled"));r.close({method:"removeFutureBooking"})},function(){a.disableCancelationSingle=!1;i.error("ERROR: Activity cannot be deleted because it occurs too near in the future.");a.dismissModal()})};a.removeFutureCombinedBooking=function(){a.disableCancelationcombined=!0;t.cancelCombinedBooking(n).then(function(){i.success(l.instant("Activity_Cancelled"));r.close({method:"removeFutureCombinedBooking"})},function(){a.disableCancelationcombined=!1;i.error("ERROR: Activity cannot be deleted because it occurs too near in the future.");a.dismissModal()})}}n.module("app").controller("activityInfoCtrl",t);t.$inject=["selectedTime","BookingService","toastr","$uibModalInstance","$aside","$scope","AuthService","$timeout","ngCart","DepartmentService","UtilityService","$translate"]})(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c){function a(n){return c.getFullAvailableTimeName(n.service,n)}var l=this;l.selectedTime=n;l.departmentPreferences=h.getDepartmentPreferences();l.departmentNouns=h.getDepartmentNouns();l.screenOptions=c.getScreenOptions();l.getProductFromCart=function(){var n=s.getItemById(l.selectedTime.id);return n===!1?!1:!0};l.addToShoppingCart=function(){var t=0;l.departmentPreferences.cust2016_ShowServicePrice==="showAll"&&(t=n.service.price);s.addItem(n.id,a(n),t,1,{product:!1,bookingInfo:n});r.close({method:"added"})};l.removeFromShoppingCart=function(){s.removeItemById(n.id);r.close({method:"removed"})};l.dismissModal=function(){r.dismiss("cancel")}}n.module("app").controller("bookingInfoCtrl",t);t.$inject=["selectedTime","BookingService","toastr","$uibModalInstance","$aside","$scope","AuthService","$timeout","ngCart","DepartmentService","UtilityService"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){function tt(){var n=parseInt(k.departmentPreferences.cust2016_DefaultSMSInterval),i,t,r;for(k.textReminderHour=n,i=!1,t=0;t<k.textReminderHoursOptions.length;t++)k.textReminderHoursOptions[t].value===n&&(i=!0);i||(r="",r=n%24==0&&n>0?n/24+" "+f.instant("Days_before"):n+" "+f.instant("Hours_before"),k.textReminderHoursOptions.push({value:n,text:r}));k.textReminderHoursOptions.sort(u.orderArrayByProperty("value"))}function it(){var n=parseInt(k.departmentPreferences.cust2016_CustDefaultEmailReminder),i,t,r;for(k.emailReminderHour=n,i=!1,t=0;t<k.emailReminderHoursOptions.length;t++)k.emailReminderHoursOptions[t].value===n&&(i=!0);i||(r="",r=n%24==0&&n>0?n/24+" "+f.instant("Days_before"):n+" "+f.instant("Hours_before"),k.emailReminderHoursOptions.push({value:n,text:r}));k.emailReminderHoursOptions.sort(u.orderArrayByProperty("value"))}function nt(){var n=function(n){console.log("back from the api...",n)},t=function(){v.error(f.instant("Error_while_booking_services"));k.working=!1};w.createBooking(d,n,t)}function rt(){var n=k.departmentPreferences.cust2016_EnableGavekortPaymentMethod==="true",t=k.departmentPreferences.cust2016_EnableVippsPaymentMethod==="true",i=k.departmentPreferences.cust2016_EnableInvoicePaymentMethod==="true",r=k.departmentPreferences.cust2016_EnableKlippekortPaymentMethod==="true";return i||n||r?!1:t}var d={},k=this,g=[];k.working=!1;k.workingStepOne=!1;k.departmentNouns=[];k.departmentPreferences=[];k.activityFields=null;k.customerInfo=null;k.customerHasEmailAddress=!1;k.customerHasMobilePhone=!1;k.customerMobilePhone=null;k.paymentWindowVisible=!1;k.showPaymentWindow=!1;k.paymentMethod="none";k.sendTextConfirmation=!1;k.sendEmailConfirmation=!1;k.sendTextReminder=!1;k.sendEmailReminder=!1;k.requireResource=y||!1;k.textReminderHour=0;k.emailReminderHour=0;k.listOfTimes=s;k.listOfProducts=h;k.textReminderHoursOptions=[{value:0,text:f.instant("Dont_send_sms")},{value:1,text:"1 "+f.instant("Hour_before")},{value:2,text:"2 "+f.instant("Hours_before")},{value:3,text:"3 "+f.instant("Hours_before")},{value:6,text:"6 "+f.instant("Hours_before")},{value:12,text:"12 "+f.instant("Hours_before")},{value:24,text:"1 "+f.instant("Day_before")},{value:48,text:"2 "+f.instant("Days_before")},{value:72,text:"3 "+f.instant("Days_before")},{value:96,text:"4 "+f.instant("Days_before")},{value:120,text:"5 "+f.instant("Days_before")}];k.emailReminderHoursOptions=[{value:0,text:f.instant("Dont_send_email")},{value:1,text:"1 "+f.instant("Hour_before")},{value:2,text:"2 "+f.instant("Hours_before")},{value:3,text:"3 "+f.instant("Hours_before")},{value:6,text:"6 "+f.instant("Hours_before")},{value:12,text:"12 "+f.instant("Hours_before")},{value:24,text:"1 "+f.instant("Day_before")},{value:48,text:"2 "+f.instant("Days_before")},{value:72,text:"3 "+f.instant("Days_before")},{value:96,text:"4 "+f.instant("Days_before")}];i.$on("PaymentDone",function(n,t,i){console.log("Payment complete.");k.working=!1;var r=[];g.indexOf("EMAIL")!==-1&&r.push(f.instant("There_was_problem_with_email"));g.indexOf("SMS")!==-1&&r.push(f.instant("There_was_problem_with_sms"));c.displayPurchaseCompleted(s,h,r,t,i);o.close("Ok");a.empty()});i.$on("PaymentFailed",function(){k.working=!1;v.error("Error has occured while booking services.");o.close("Ok");a.empty()});i.$on("PaymentCancelled",function(){k.working=!1;v.warning("Vipps payment has been cancelled.");o.close("Ok");a.empty()});k.activityFields=n;k.departmentNouns=e.getDepartmentNouns();k.departmentPreferences=e.getDepartmentPreferences();r.getCustomerEmailAndPhone().then(function(n){k.customerHasEmailAddress=n.data.email!==null&&n.data.email.length>0;k.customerHasMobilePhone=n.data.phone!==null&&n.data.phone.length>0;k.customerMobilePhone=n.data.phone}).then(function(){k.customerInfo=t;k.sendEmailConfirmation=k.departmentPreferences.cust2016_ConfirmationEmailDefault==="true"&&k.customerHasEmailAddress;k.sendTextConfirmation=k.departmentPreferences.cust2016_SMSConfirmationCust==="true"&&k.customerHasMobilePhone;k.sendEmailReminder=(k.departmentPreferences.cust2016_CustDefaultEmailReminder>0?!0:!1)&&k.customerHasEmailAddress;k.sendTextReminder=(k.departmentPreferences.cust2016_DefaultSMSInterval>0?!0:!1)&&k.sendTextConfirmation;tt();it()});k.openPaymentWindow=function(){rt()&&k.setPaymentMethod(k.getVippsPaymentMethodName());k.paymentWindowVisible=!0};k.closePaymentWindow=function(){k.paymentWindowVisible=!1;k.workingStepOne=!1;k.setPaymentMethod(k.getNoPaymentMethodName())};k.saveMobilePhone=function(){var n=r.updateCustomerMobile(k.customerMobilePhone,"no");k.customerHasMobilePhone=n===null?!1:!0};k.selectedPaymentMethodAccepted=function(){return k.paymentMethod===k.getNoPaymentMethodName()?!1:(k.paymentMethod===k.getVippsPaymentMethodName(),!0)};k.validateAndPerformPayment=function(n){if(s&&k.departmentPreferences.cust2016_MaxNoOfFutureBookingsForCustomer!=null&&k.departmentPreferences.cust2016_MaxNoOfFutureBookingsForCustomer!=""&&parseInt(k.departmentPreferences.cust2016_MaxNoOfFutureBookingsForCustomer)>0){var t=parseInt(k.departmentPreferences.cust2016_MaxNoOfFutureBookingsForCustomer);r.getCustomerFutureBookings().then(function(i){var f=i.data,h=f?f.length:0,r,u,e,o;if(h+s.length>t)return v.error("Totalt antall bestillinger samme kunde kan ha frem i tid er "+t),!1;for(r=0;r<s.length;r++)if(s[r].service&&s[r].service.id>0&&!s[r].service.isCombined&&s[r].service.maxNoOfFutureBookings>0&&(u=s[r].service.maxNoOfFutureBookings,u>t&&(u=t),e=f.filter(function(n){return n.serviceId===s[r].service.id}),o=s.filter(function(n){return n.service.id===s[r].service.id&&!n.isCombined}),(e?e.length:0)+(o?o.length:0)>u))return v.error("Totalt antall bestillinger samme kunde kan ha frem i tid på "+s[r].service.name+" er "+u),!1;k.performPayment(n)})}else k.performPayment(n)};k.performPayment=function(n){n&&(i.paymentOnSite=!0);k.proceedToPayment()};k.proceedToPayment=function(){k.workingStepOne=!0;var n={sendTextConfirmation:k.sendTextConfirmation,sendEmailConfirmation:k.sendEmailConfirmation,sendTextReminder:k.textReminderHour,sendEmailReminder:k.emailReminderHour,requireResource:k.requireResource,textReminderHour:k.textReminderHour,emailReminderHour:k.emailReminderHour,paymentMethod:k.paymentMethod,customerMobilePhone:k.customerMobilePhone};d=u.getBookingObject(n,k.activityFields,s,h);u.saveProductsAndServices(s,h);l.checkIfTimesCanBeReserved(d).then(function(n){var e=[],a=[],f,h,v,l,t,y,w,nt,tt,it,rt;for(g=n.data.errorMessages||[],f=n.data,t=0;t<f.length;t++)h={id:f[t].proposal.serviceTimeId,serviceName:f[t].serviceName,customerId:f[t].proposal.customerId,endDate:f[t].endDate,serviceId:f[t].proposal.serviceId,startDate:f[t].startDate},f[t].success===!1?e.push(h):a.push(h);if(e.length===0){for(v=u.getTotalCostOfShoppingCart(),l=0,t=0;t<s.length;t++)l+=s[t].service.price;y=k.departmentPreferences.cust2016_EnablePaymentSystem==="true";w=l+v!==0;y&&w&&!i.paymentOnSite?(nt=k.departmentPreferences.cust2016_EnableGavekortPaymentMethod==="true",tt=k.departmentPreferences.cust2016_EnableKlarnaPaymentMethod==="true",tt&&k.areActivitiesOnSameDay()&&!nt?(d.paymentMethod=b.klarna,o.close(!1),p.go("klarnacheckout",{bookingItems:d})):(it=d.activities.map(function(n){return n.serviceId}),k.fetchingPunchcards=!0,r.getPunchCardDetails(it).then(function(n){k.moreThanOnePunchCardAvailable=n.data.length>0;k.fetchingPunchcards=!1}),k.openPaymentWindow())):k.confirmPurchase()}else rt=c.displayPurchaseNotCompletedModal(e,a),rt.result.then(function(n){var i,t;if(n===!0){for(i=0;i<e.length;i++)for(t=0;t<s.length;t++)s[t].id===e[i].id&&s.splice(t,1);s.length===0?o.dismiss():k.proceedToPayment()}},function(){o.dismiss()})},function(){console.log("Error")})};k.paymentOnSiteEnabled=function(){return k.departmentPreferences.cust2016_EnablePaymentSystem==="true"&&k.departmentPreferences.cust2016_EnablePayInShopPaymentMethod==="true"};k.klarnaEnabled=function(){return k.departmentPreferences.cust2016_EnablePaymentSystem==="true"&&k.departmentPreferences.cust2016_EnableKlarnaPaymentMethod==="true"&&k.departmentPreferences.cust2016_EnableKlarnaPayInShop!=="true"};k.setPaymentMethod=function(n){k.paymentMethod=n};k.areActivitiesOnSameDay=function(){if(!k.listOfTimes||k.listOfTimes.length===1)return!0;var n=new Date(Date.parse(k.listOfTimes[0].start)),t=k.listOfTimes.filter(function(t){var i=new Date(Date.parse(t.start)),r=i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate();return!r});return t.length===0};k.confirmPurchase=function(){var n,t;d.paymentMethod=k.paymentMethod;d.customerMobilePhone===""&&(d.customerMobilePhone=k.customerMobilePhone);d.paymentMethod==="klippekort"?(n=d.activities.map(function(n){return n.serviceId}),r.getPunchCardDetails(n).then(function(n){var t=c.displayPunchCardSelect(n.data);t.result.then(function(n){d.punchCards.includes(n)||d.punchCards.push(n);k.working=!0;nt()}).catch(function(n){n?v.error(f.instant("Error_while_selecting_klippekort")):v.warning(f.instant("You_have_to_pick_a_klippekort"));k.working=!1})}).catch(function(){v.error(f.instant("Error_while_getting_available_punch_cards"));k.working=!1})):d.paymentMethod==="gavekort"?(t=c.displayGiftCertificateSelect(d.activities,d.products),t.result.then(function(n){!d.giftCertificates.indexOf(n)>=0&&d.giftCertificates.push(n);k.working=!0;nt()}).catch(function(n){n?v.error(f.instant("Error_while_validating_gift_certificate")):v.warning(f.instant("You_have_to_pick_a_gift_certificate"));k.working=!1})):d.paymentMethod==="klarna"?(d.paymentMethod=b.klarna,o.close(!1),p.go("klarnacheckout",{bookingItems:d})):(k.working=!0,nt())};k.cancel=function(){var n=confirm(f.instant("The_order_is_not_completed"));n&&o.dismiss()};k.getVippsPaymentMethodName=function(){return"vipps"};k.getNoPaymentMethodName=function(){return"none"};k.isFormValid=function(){return!0}}n.module("app").controller("confirmPurchaseCtrl",t);t.$inject=["activityFields","customerInfo","$scope","UserAccountService","UtilityService","$translate","DepartmentService","$uibModalInstance","onlyBookingItems","onlyProductItems","ModalService","BookingService","ngCart","toastr","requireResource","$state","PurchaseService","CONST"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e){var o=this,s;o.maxRate=5;o.bookingOfCurrentCustomer=!1;o.editingFeedback=!1;o.currentBooking=n;o.currentFeedback={};o.working=!1;s=!1;o.authData=e.getAuth();o.authData.isAuth?r.getCustomerInfo().then(function(t){t.data.id===n.customerId&&(o.bookingOfCurrentCustomer=!0)}):o.bookingOfCurrentCustomer=!1;i.getFeedback(o.currentBooking.historyId).then(function(n){o.currentFeedback=n.data});o.departmentPreferences=f.getDepartmentPreferences();o.departmentNouns=f.getDepartmentNouns();o.cancel=function(){s?t.close("Closed"):t.dismiss("Canceled")};o.editFeedback=function(){o.editingFeedback=!0};o.updateFeedback=function(){s=!0;o.working=!0;var n={historyId:o.currentBooking.historyId,rate:o.currentFeedback.rate,message:o.currentFeedback.message};i.updateFeedback(n).then(function(){u.success("Updated!")},function(n){console.log(n)}).finally(function(){o.editingFeedback=!1;o.working=!1})}}n.module("app").controller("feedbackInfoCtrl",t);t.$inject=["booking","$uibModalInstance","FeedbackService","UserAccountService","toastr","DepartmentService","AuthService"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c,l){function v(n){var t=/^[\d \+]+$/.test(n);return t?"mobile":"email"}var a=this;a.confirmationType=null;a.loginData={};a.departmentInfo={};a.departmentPreferences={};a.working=!1;a.departmentInfo=u.getDepartmentInfo();a.loginData.loginType=a.departmentInfo.authenticationMethods.indexOf("email")!==-1?"email":a.departmentInfo.authenticationMethods[0];a.departmentPreferences=u.getDepartmentPreferences();a.passwordRegex=t.getPasswordStrengthRegex();a.passwordRegexMessage=t.getPasswordStrengthRegexMessage();a.getUsernamePlaceholder=function(){return a.departmentInfo.authenticationMethods.length>1?o.instant("Email_or_Mobile"):a.departmentInfo.authenticationMethods[0]==="email"?o.instant("Email"):o.instant("Mobile")};i.getCustomerScheme().then(function(n){a.customerFields=n.data;FB.api("/me",{fields:"first_name,last_name,email,address,birthday,location"},function(n){for(var i,r=["first_name","last_name","email","address","birthday","location"],u=["Name","SurName","Email","Address1","BirthDate","Address2"],t=0;t<r.length;t++)if(n[r[t]])for(i=0;i<a.customerFields.length;i++)a.customerFields[i].name===u[t]&&(a.customerFields[i].value=n[r[t]])})});a.login=function(){a.working=!0;a.loginData.loginType=v(a.loginData.userName);s(function(){h.login(a.loginData).then(function(){a.logginData={};l.linkCustomerIdToExternalId(c).then(function(){if(r.close("ok"),a.departmentPreferences.cust2016_AllowReservationRule=="true"){$window.location.reload();return}})},function(){o("Wrong_username_or_password").then(function(n){e.error(n)})}).finally(function(){a.working=!1})},2500)};a.register=function(t){var u,f,s,v;if(a.password!==a.confirmPassword){e.error("Passwords do not match!");return}for(a.working=!0,u={id:0,fields:{}},f=0;f<a.customerFields.length;f++)s=a.customerFields[f].name,v=a.customerFields[f].value,u.fields[s]=v;u.password=a.password;i.getDuplicatedCustomerFields(u.fields).then(function(i){var f=i.data,s,v,y;if(f.length>0&&!t){s=f.filter(function(n){return n.uniqueLevel===1});v=f.filter(function(n){return n.uniqueLevel===2});v.length>0?alert(o.instant("User_with_this_fields_already_exists")+" "+v.map(function(n){return n.caption})):s.length>0&&(y=confirm(o.instant("User_with_this_fields_already_exists")+" "+s.map(function(n){return n.caption})+". "+o.instant("Create_user_anyway")),y&&a.register(!0));a.working=!1;return}h.register(u).then(function(){a.password="";a.confirmPassword="";r.close("ok");n&&typeof n=="function"&&n();l.linkCustomerIdToExternalId(c).then(function(){if(r.close("ok"),a.departmentPreferences.cust2016_AllowReservationRule=="true"){$window.location.reload();return}})},function(){e.error("Error!")}).finally(function(){a.working=!1})})}}n.module("app").controller("firstTimeLoginFromExternalAccountCtrl",t);t.$inject=["callbackFunction","UtilityService","UserAccountService","$uibModalInstance","DepartmentService","ModalService","toastr","$translate","$timeout","AuthService","externalAccessToken","ExternalLoginService"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o){function h(n){var t=/^[\d \+]+$/.test(n);return t?"sms":"email"}var s=this;s.passwordData={field:"",value:""};s.departmentInfo={authenticationMethods:""};s.working=!1;s.departmentInfo=u.getDepartmentInfo();s.departmentPreferences=u.getDepartmentPreferences();s.sendPasswordReminder=function(){s.working=!0;s.passwordData.field=h(s.passwordData.value);s.stripWhiteSpacesFromString(s.passwordData);r(function(){t.sendPasswordReminder(s.passwordData.field,s.passwordData.value).then(function(){i.success(f.instant("Password_sent"));s.passwordData={};n.$hide()},function(){e.positionClass="toast-top-left";i.error(f.instant("Could_not_find_customer"));e.positionClass="toast-top-right"}).finally(function(){s.working=!1})},1500)};s.getUsernamePlaceholder=function(){return s.departmentInfo.authenticationMethods.length>1?f.instant("Email_or_Mobile"):s.departmentInfo.authenticationMethods[0]==="email"?f.instant("Email"):f.instant("Mobile")};s.getEnterCredentialsText=function(){return s.departmentInfo.authenticationMethods.length>1?f.instant("Please_enter_your_email_address_or_mobile_to_retrieve_password1"):s.departmentInfo.authenticationMethods[0]==="email"?f.instant("Please_enter_your_email_address_to_retrieve_password"):f.instant("Please_enter_your_mobile_to_retrieve_password")};s.stripWhiteSpacesFromString=function(n){n&&n.value&&(n.value=o.stripWhiteSpacesFromString(n.value))}}n.module("app").controller("forgotPasswordCtrl",t);t.$inject=["$scope","AuthService","toastr","$timeout","DepartmentService","$translate","toastrConfig","UtilityService"]}(window.angular),function(n){"use strict";function t(n,t,i,r){var u=this;u.recipient={firstName:"",lastName:"",email:""};u.sender={customerId:0,firstName:"",lastName:"",email:""};u.comment="";u.confirmOptions=function(){n.close({recipient:u.recipient,sender:u.sender,comment:u.comment})};u.dismiss=function(t){n.dismiss(t)};r.getCustomerInfo().then(function(n){var t=n.data;u.sender.firstName=t.name;u.sender.lastName=t.fields.surname;u.sender.customerId=t.id;u.sender.email=t.fields.email})}n.module("app").controller("giftCertificateOptionsController",t);t.$inject=["$uibModalInstance","$translate","toastr","UserAccountService"]}(window.angular),function(n){"use strict";function t(n,t,i,r){var u=this;u.paymentMethod="vipps";u.vippsTelephoneNumber="";u.setPaymentMethod=function(n){u.paymentMethod=n};u.confirmSelect=function(){u.paymentMethod?n.close({paymentMethod:u.paymentMethod,vipps:{telephoneNumber:u.vippsTelephoneNumber}}):i.error("You must select a payment method.")};u.dismiss=function(t){n.dismiss(t)};r.getCustomerInfo().then(function(n){var t=n.data;console.log(t);u.vippsTelephoneNumber=t.fields.phone2})}n.module("app").controller("giftCertificatePaymentController",t);t.$inject=["$uibModalInstance","$translate","toastr","UserAccountService"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f){var e=this;e.number="";e.code="";e.dismiss=function(){t.dismiss()};e.selectCertificate=function(){var o={giftCertificateNumber:e.number,giftCertificateCode:e.code,activities:u,products:f};n.validateGiftCertificate(o).then(function(n){n.data.status===1?t.close(n.data.giftCertificateId):n.data.status===2?r.error(i.instant("Selected_gift_certificate_does_not_exist")):n.data.status===3?r.error(i.instant("Selected_gift_certificate_is_no_longer_valid")):n.data.status===4&&r.error(i.instant("Selected_gift_certificate_does_not_have_sufficient_balance"))}).catch(function(){r.error(i.instant("Error_while_validating_gift_certificate"))})}}n.module("app").controller("giftCertificateSelectController",t);t.$inject=["BookingService","$uibModalInstance","$translate","toastr","activities","products"]}(window.angular),function(n){"use strict";function t(n,t,i){function f(){r.counter!==1?(r.counter--,u=n(f,1e3)):e()}function e(){n.cancel(u);i.dismiss("Canceled");t.kickOut()}function o(){n.cancel(u);i.dismiss("Canceled");t.start()}var r=this,u;r.counter=30;r.endSession=e;r.continueSession=o;u=n(f,1e3);i.result.then(function(){},function(n){n==="backdrop click"&&o()})}n.module("app").controller("kioskKickoutAlertCtrl",t);t.$inject=["$timeout","IdleService","$uibModalInstance"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){function g(){var n=0;return k.departmentPreferences.cust2016_EnableUsernameAndPasswordLogin=="true"&&(n+=1),k.departmentPreferences.cust2016_EnableLoginWithPnrAndMobile=="true"&&(n+=1),k.departmentPreferences.cust2016_EnableFacebookLogin=="true"&&(n+=1),k.departmentPreferences.cust2016_EnableVippsLogin=="true"&&(n+=1),k.departmentPreferences.cust2016_LoginWithOneTimePassword=="true"&&(n+=1),n}function nt(){return k.departmentPreferences.cust2016_EnableUsernameAndPasswordLogin=="true"?1:k.departmentPreferences.cust2016_EnableVippsLogin=="true"?2:k.departmentPreferences.cust2016_EnableLoginWithPnrAndMobile=="true"?3:k.departmentPreferences.cust2016_LoginWithOneTimePassword=="true"?4:k.departmentPreferences.cust2016_EnableFacebookLogin=="true"?5:void 0}function d(){k.working=!1;k.loginOneTimePassData.sendOneTimePass=!1;k.loginOneTimePassData.disableMobileField=!1;k.loginOneTimePassData.selectedCustomerWithSameMobile=null;k.loginOneTimePassData.customerListWithSameMobile=[];k.loginOneTimePassData.validatingOneTimePassword=!1}function tt(n){var t=/^[\d \+]+$/.test(n);return t?"mobile":"email"}var k=this;k.loginData={loginType:"",userName:"",password:""};k.departmentInfo={authenticationMethods:""};k.departmentPreferences={};k.loginData.loginType="";k.working=!1;k.loginOneTimePassData={sendOneTimePass:!1,mobile:"",code:"",disableMobileField:!1,selectedCustomerWithSameMobile:null,customerListWithSameMobile:[],validatingOneTimePassword:!1};k.loginWithPersonalNrAndMobileData={mobile:"",personalNr:""};k.loginVippsData={vippsLoginOk:!1};y!==undefined&&y!==null&&y.type==="OneTimePassword"&&y.hasOneTimePasswordSent&&y.customer!==undefined&&y.customer!==null&&(k.loginOneTimePassData.sendOneTimePass=!0,k.loginOneTimePassData.customerListWithSameMobile.push(y.customer));k.departmentInfo=s.getDepartmentInfo();k.loginData.loginType=k.departmentInfo.authenticationMethods.indexOf("email")!==-1?"email":k.departmentInfo.authenticationMethods[0];k.departmentPreferences=s.getDepartmentPreferences();k.loginOptions=y;k.noOfLoginMethods=g();k.displayLoginType=k.noOfLoginMethods==1?nt():0;k.departmentPreferences.cust2016_EnableVippsLogin=="true"&&y!==undefined&&y!==null&&y.type!==undefined&&y.type!==null&&y.type=="Vipps"&&(k.loginVippsData.vippsLoginOk=!0,k.displayLoginType=2);k.languageId=k.departmentInfo.languageId;k.login=function(){k.working=!0;k.loginData.loginType=tt(k.loginData.userName);k.stripWhiteSpaceFromString(k.loginData);o(function(){f.login(k.loginData).then(function(){k.logginData={};r.$hide();n.sendAccessTokenToUserPages();c&&typeof c=="function"&&c()},function(){h("Wrong_username_or_password").then(function(n){e.error(n)})}).finally(function(){k.working=!1})},2500)};k.setDisplayLoginType=function(n){k.displayLoginType=n};k.displayRegisterForm=function(){r.$hide();i.displayRegisterForm(c)};k.displayRegisterFormForLoginWithPersonalNr=function(){r.$hide();i.displayRegisterForm(c,{newCustomer:!0,fields:[{key:"phone2",value:k.loginWithPersonalNrAndMobileData.mobile},{key:"ssn",value:k.loginWithPersonalNrAndMobileData.personalNr}],type:"PersonalNumberAndMobile"})};k.displayForgotPasswordForm=function(){r.$hide();i.displayForgotPasswordForm()};k.getUsernamePlaceholder=function(){return k.departmentInfo.authenticationMethods.length>1?h.instant("Email_or_Mobile"):k.departmentInfo.authenticationMethods[0]==="email"?h.instant("Email"):h.instant("Mobile")};k.authenticateWithFacebook=function(){FB.login(function(n){n.status==="connected"&&FB.api("/me",{access_token:n.authResponse.accessToken},{fields:"email, first_name, last_name"},function(n){if(!(n&&n.id&&n.email&&n.first_name&&n.last_name)){e.error("Error");return}var t={externalId:n.id,email:n.email,firstName:n.first_name,lastName:n.last_name};l.getConnectedCustomerAndLoginWithFacebook(t).then(function(n){if(n.data.is_new_customer)r.$hide(),i.displayRegisterForm(c,{newCustomer:!0,fields:[{key:"name",value:t.firstName},{key:"surname",value:t.lastName},{key:"email",value:t.email}],type:"LoginWithFacebook",details:{externalId:t.externalId}});else{var u=n.data.access_token,o=n.data.username;if(f.performExternalLogin(u,o),h("You_have_been_logged_in").then(function(n){e.success(n)}),r.$hide(),c!==undefined&&c&&typeof c=="function"&&c(),b.current.name==="login"&&b.go("home"),k.departmentPreferences.cust2016_AllowReservationRule=="true"){v.location.reload();return}}})})},{scope:"email, public_profile"})};k.authenticateWithOneTimePassword=function(){var n=0;k.loginOneTimePassData.customerListWithSameMobile.length>1&&k.loginOneTimePassData.selectedCustomerWithSameMobile!==null?n=k.loginOneTimePassData.selectedCustomerWithSameMobile.id:k.loginOneTimePassData.customerListWithSameMobile.length===1&&(n=k.loginOneTimePassData.customerListWithSameMobile[0].id);n>0&&k.loginOneTimePassData.code!==""?(k.loginOneTimePassData.validatingOneTimePassword=!0,l.loginWithOneTimePassword(n,k.loginOneTimePassData.code).then(function(n){if(n.data.valid){var t=n.data.access_token,i=n.data.username;if(f.performExternalLogin(t,i),h("You_have_been_logged_in").then(function(n){e.success(n)}),r.$hide(),c!==undefined&&c&&typeof c=="function"&&c(),b.current.name==="login"&&b.go("home"),k.departmentPreferences.cust2016_AllowReservationRule==="true"){v.location.reload();return}}else k.loginOneTimePassData.code="",k.loginOneTimePassData.validatingOneTimePassword=!1})):e.error("Invalid customer or empty code")};k.loginCustomerWithVipps=function(n){l.authenticateWithVipps(n,k.loginOptions.code).then(function(n){if(n.data.valid&&(f.performExternalLogin(n.data.access_token,n.data.username),h("You_have_been_logged_in").then(function(n){e.success(n)}),r.$hide(),c!==undefined&&c&&typeof c=="function"&&c(),b.current.name==="login"&&b.go("home"),k.departmentPreferences.cust2016_AllowReservationRule==="true")){v.location.reload();return}})};k.loginWithVipps=function(){l.getVippsApiUrl().then(function(n){l.getVippsLoginConfig().then(function(t){if(t.data&&t.data.key!=""){var i=p.protocol(),r=p.host(),u=i+"://"+r+rootApplicationURL;w!==undefined&&w!==null&&sessionStorage.setItem("VippsBookingItems",JSON.stringify(w));sessionStorage.setItem("VippsAuthState",t.data.state);v.location=`${n.data}oauth2/auth?msn=${t.data.key}&response_type=code&state=${t.data.state}&scope=phoneNumber%20name&redirect_uri=${u}`}else e.error("Vipps MSN is empty.")})})};k.stripWhiteSpaceFromString=function(n){n&&n.userName&&(n.userName=t.stripWhiteSpacesFromString(n.userName))};k.checkCustomersWithSameMobileNumber=function(){k.working=!0;k.loginOneTimePassData.customerListWithSameMobile.length>1&&k.loginOneTimePassData.selectedCustomerWithSameMobile!==null?k.sendOneTimePassword(k.loginOneTimePassData.selectedCustomerWithSameMobile.id):a.getCustomerByMobile(k.loginOneTimePassData.mobile).then(function(n){k.loginOneTimePassData.customerListWithSameMobile=n.data;k.loginOneTimePassData.customerListWithSameMobile.length>1?(k.working=!1,k.loginOneTimePassData.sendOneTimePass=!1,k.loginOneTimePassData.disableMobileField=!0):k.loginOneTimePassData.customerListWithSameMobile.length===1?k.sendOneTimePassword(k.loginOneTimePassData.customerListWithSameMobile[0].id):(r.$hide(),i.displayRegisterForm(c,{newCustomer:!0,fields:[{key:"phone2",value:k.loginOneTimePassData.mobile}],type:"OneTimePassword"}))},function(){d();e.error(h.instant("Error_while_sending_onetime_password"))})};k.disableSendOneTimePasswordBtn=function(){return k.working||k.loginOneTimePassData.mobile===null||k.loginOneTimePassData.mobile===""||k.loginOneTimePassData.customerListWithSameMobile.length>1&&k.loginOneTimePassData.selectedCustomerWithSameMobile===null};k.disableLoginOneTimePasswordBtn=function(){return k.loginOneTimePassData.validatingOneTimePassword||k.loginOneTimePassData.code===null||k.loginOneTimePassData.code===""};k.sendOneTimePassword=function(n){o(function(){f.sendOneTimePassword(n).then(function(n){n?(k.loginOneTimePassData.sendOneTimePass=!0,e.success(h.instant("OneTime_password_sent"))):(d(),e.error(h.instant("Error_while_sending_onetime_password")))},function(){d();e.error(h.instant("Error_while_sending_onetime_password"))})},1500)};k.disableLoginWithPersonalNrAndMobileBtn=function(){return k.working||k.loginWithPersonalNrAndMobileData.mobile===null||k.loginWithPersonalNrAndMobileData.mobile===""||k.loginWithPersonalNrAndMobileData.personalNr===null||k.loginWithPersonalNrAndMobileData.personalNr===""};k.disableLoginWithUsernameAndPasswordBtn=function(){return k.working||k.loginData.userName===null||k.loginData.userName===""||k.loginData.password===null||k.loginData.password===""};k.authenticateWithPersonalNrAndMobile=function(){l.loginWithPersonalNrAndMobile(k.loginWithPersonalNrAndMobileData.personalNr,k.loginWithPersonalNrAndMobileData.mobile).then(function(n){if(n.data.valid){var t=n.data.access_token,i=n.data.username;if(f.performExternalLogin(t,i),h("You_have_been_logged_in").then(function(n){e.success(n)}),r.$hide(),c!==undefined&&c&&typeof c=="function"&&c(),b.current.name==="login"&&b.go("home"),k.departmentPreferences.cust2016_AllowReservationRule==="true"){v.location.reload();return}}else n.data.errorType&&n.data.errorType==2?e.error(h.instant("Invalid_personal_number")):e.error(h.instant("Invalid_personal_number_and_mobile"))})}}n.module("app").controller("loginCtrl",t);t.$inject=["NikitaService","UtilityService","ModalService","$scope","$aside","AuthService","toastr","$timeout","DepartmentService","$translate","callbackFunction","ExternalLoginService","UserAccountService","$window","options","$location","bookingItems","$state"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function k(n){var t={sendTextConfirmation:y.sendTextConfirmation,sendEmailConfirmation:y.sendEmailConfirmation,sendTextReminder:y.textReminderHour,sendEmailReminder:y.emailReminderHour,requireResource:y.requireResource,textReminderHour:y.textReminderHour,emailReminderHour:y.emailReminderHour,paymentMethod:"none",customerMobilePhone:""};p=l.getBookingObject(t,y.activityFields,i,b);l.saveProductsAndServices(i,b);c.checkIfTimesCanBeReservedForLoginWithoutPassword(p,y.customerSchemeField.name,y.fieldValue,n).then(function(t){var e=[],l=[],r,i,f,s,h;for(w=t.data.errorMessages||[],r=t.data,i=0;i<r.length;i++)f={id:r[i].proposal.serviceTimeId,serviceName:r[i].serviceName,customerId:r[i].proposal.customerId,endDate:r[i].endDate,serviceId:r[i].proposal.serviceId,startDate:r[i].startDate},r[i].success===!1?e.push(f):l.push(f);e.length===0?(p.customerMobilePhone="",s=function(n){console.log("back from the api...",n)},h=function(){o.error(u.instant("Error_while_booking_services"))},c.createBookingForLoginWithoutPassword(p,y.customerSchemeField.name,y.fieldValue,n).then(s,h)):(y.working=!1,o.error("Error"))},function(){y.working=!1;console.log("Error")})}function d(n){if(i&&y.departmentPreferences.cust2016_MaxNoOfFutureBookingsForCustomer!=null&&y.departmentPreferences.cust2016_MaxNoOfFutureBookingsForCustomer!=""&&parseInt(y.departmentPreferences.cust2016_MaxNoOfFutureBookingsForCustomer)>0){var t=parseInt(y.departmentPreferences.cust2016_MaxNoOfFutureBookingsForCustomer);e.getCustomerFutureBookingsForLoginWithoutPassword(y.customerSchemeField.name,y.fieldValue,n).then(function(r){var e=r.data,c=e?e.length:0,u,f,s,h;if(c+i.length>t)return y.working=!1,o.error("Totalt antall bestillinger samme kunde kan ha frem i tid er "+t),!1;for(u=0;u<i.length;u++)if(i[u].service&&i[u].service.id>0&&!i[u].service.isCombined&&i[u].service.maxNoOfFutureBookings>0&&(f=i[u].service.maxNoOfFutureBookings,f>t&&(f=t),s=e.filter(function(n){return n.serviceId===i[u].service.id}),h=i.filter(function(n){return n.service.id===i[u].service.id&&!n.isCombined}),(s?s.length:0)+(h?h.length:0)>f))return y.working=!1,o.error("Totalt antall bestillinger samme kunde kan ha frem i tid på "+i[u].service.name+" er "+f),!1;k(n)})}else k(n)}var y=this,w=[],p={},b=[];y.customerSchemeField=r;y.fieldValue="";y.activityFields=null;y.sendEmailConfirmation=!1;y.sendTextConfirmation=!1;y.sendEmailReminder=!1;y.sendTextReminder=!1;y.textReminderHour=!1;y.emailReminderHour=!1;y.otherRequiredFields=[];y.working=!1;y.requireResource=!1;t&&t.requireResource&&(y.requireResource=t.requireResource);y.onlyNumbersRegex=l.getOnlyNumbersRegex();y.departmentPreferences=h.getDepartmentPreferences();h.getActivityScheme().then(function(n){y.activityFields=n.data});v.$on("PaymentDone",function(n,t,r){console.log("Payment complete.");y.working=!1;var e=[];w.indexOf("EMAIL")!==-1&&e.push(u.instant("There_was_problem_with_email"));w.indexOf("SMS")!==-1&&e.push(u.instant("There_was_problem_with_sms"));s.displayPurchaseCompleted(i,b,e,t,r);f.close("Ok");a.empty()});y.getDescription=function(){return u.instant("Login_without_password_description").replace("{0}","<b>"+y.customerSchemeField.caption+"<\/b>").replace("{1}","'<b>").replace("{2}","<\/b>'")};y.stripWhiteSpacesFromString=function(){y.fieldValue=l.stripWhiteSpacesFromString(y.fieldValue)};y.getSelectedServicesTextArray=function(){for(var t,r=[],n=0;n<i.length;n++)t=new Date(i[n].start),r.push(t.toLocaleDateString()+" kl. "+t.toTimeString().substr(0,5)+" - "+i[n].service.name+" | "+i[n].service.duration+" min | "+i[n].service.price+"kr");return r};y.dismissModal=function(){f.dismiss("cancel")};y.getFieldName=function(){var n="Other";return y.customerSchemeField.type=="String"&&(y.customerSchemeField.name=="SSN"?n="SSN":y.customerSchemeField.subType=="Email"?n="Email":(y.customerSchemeField.subType=="SMS"||y.customerSchemeField.subType=="Phone")&&(n="Phone")),n};y.performLogin=function(){f.close("Ok");s.displayLoginForm(n,t,i,!1)};y.proceedToBooking=function(){var i,t,r,n;if(y.working=!0,i=null,y.otherRequiredFields&&y.otherRequiredFields.length>0)for(i={},t=0;t<y.otherRequiredFields.length;t++)r=y.otherRequiredFields[t].name,n=y.otherRequiredFields[t].value,i[r]=y.otherRequiredFields[t].type=="Date"&&n!=undefined&&n!=null&&n!=""?n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate():n;e.loginWithoutPassword(y.customerSchemeField.name,y.fieldValue,i).then(function(n){n.data.success?(y.sendEmailConfirmation=y.departmentPreferences.cust2016_ConfirmationEmailDefault==="true"&&n.data.hasEmailAddress,y.sendTextConfirmation=y.departmentPreferences.cust2016_SMSConfirmationCust==="true"&&n.data.hasMobilePhoneNumber,y.sendEmailReminder=(y.departmentPreferences.cust2016_CustDefaultEmailReminder>0?!0:!1)&&n.data.hasEmailAddress,y.sendTextReminder=(y.departmentPreferences.cust2016_DefaultSMSInterval>0?!0:!1)&&y.sendTextConfirmation,y.textReminderHour=parseInt(y.departmentPreferences.cust2016_DefaultSMSInterval),y.emailReminderHour=parseInt(y.departmentPreferences.cust2016_CustDefaultEmailReminder),d(n.data.customerId)):n.data.errorType==1?(y.working=!1,o.error("'"+y.customerSchemeField.caption+"' is not valid!")):n.data.errorType==2?(y.working=!1,o.error("'"+y.customerSchemeField.caption+"' is not unique!")):(y.working=!1,y.otherRequiredFields=n.data.otherRequiredFields.fields)})}}n.module("app").controller("loginWithoutPasswordCtrl",t);t.$inject=["callbackFunction","options","onlyBookingItems","customerSchemeField","$translate","$uibModalInstance","UserAccountService","toastr","ModalService","DepartmentService","BookingService","UtilityService","ngCart","$scope"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u){var f=this;f.maxRate=5;f.product=i;f.productFeedback={};f.editingFeedback=!1;f.customerCanRateProduct=!1;f.currentCustomerProductRating=null;f.departmentPreferences={};r.getProductFeedbacks(f.product.id).then(function(n){f.productFeedback=n.data});r.canCustomerRateThisProduct(f.product.id).then(function(n){f.customerCanRateProduct=n.data;r.getProductFeedbackByCustomer(f.product.id).then(function(n){f.currentCustomerProductRating=n.data})});f.departmentPreferences=n.getDepartmentPreferences();f.cancel=function(){t.dismiss("Canceled")};f.editFeedback=function(){f.editingFeedback=!0};f.updateFeedback=function(){f.working=!0;r.updateProductFeedback(f.product.id,f.currentCustomerProductRating.message,f.currentCustomerProductRating.rate).then(function(){r.getProductFeedbacks(f.product.id).then(function(n){f.productFeedback=n.data});u.success("Updated!")},function(){}).finally(function(){f.editingFeedback=!1;f.working=!1})}}n.module("app").controller("productInfoCtrl",t);t.$inject=["DepartmentService","$uibModalInstance","product","FeedbackService","toastr"]}(window.angular),function(n){"use strict";function t(n,t){var i=this;i.punchCardDetails=n;i.selectedPunchCardId=0;i.dismiss=function(){t.dismiss()};i.selectPunchCard=function(){t.close(i.selectedPunchCardId)}}n.module("app").controller("punchCardSelectController",t);t.$inject=["punchCardDetails","$uibModalInstance"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c,l,a,v){var y=this;y.listOfTimes=u;y.listOfProducts=f;y.departmentNouns=i.getDepartmentNouns();y.departmentPreferences=i.getDepartmentPreferences();y.departmentInfo={};y.errors=e;y.paymentMethod=o;y.invoiceId=s;y.isKioskMode=y.departmentPreferences.cust2016_RunInKioskMode==="true";y.departmentInfo=i.getDepartmentInfo();y.cancel=function(){t.dismiss("Canceled")};t.result.then(function(){},function(){y.departmentPreferences.cust2016_RedirectUrlAfterConfirmation!==""?a.location=y.departmentPreferences.cust2016_RedirectUrlAfterConfirmation:r.go("home")});y.downloadInvoice=function(){return c.getInvoicePdf(y.invoiceId).catch(function(){l.error(n.instant("Error_while_downloading_invoice"))})};y.showReceiptModal=function(){return c.getReceiptHtml(y.invoiceId).then(function(n){h.displayReceipt(n.data.receiptHtmlString)},function(){l.error(n.instant("Error_while_downloading_receipt"))})};y.endKioskSession=function(){v.kickOut()}}n.module("app").controller("purchaseCompletedCtrl",t);t.$inject=["$translate","$uibModalInstance","DepartmentService","$state","listOfTimes","listOfProducts","errors","paymentMethod","invoiceId","ModalService","BookingService","toastr","$window","IdleService"]}(window.angular),function(n){"use strict";function t(n,t,i,r){var u=this;u.notPurchasedItems=n;u.purchasedItems=t;u.departmentPreferences=r.getDepartmentPreferences();u.cancel=function(){i.dismiss("Canceled")};u.bookRemainingItems=function(){i.close(!0)}}n.module("app").controller("purchaseNotCompletedCtrl",t);t.$inject=["notPurchasedItems","purchasedItems","$uibModalInstance","DepartmentService"]}(window.angular),function(n){"use strict";function t(t,i,r,u,f,e,o,s,h,c,l,a,v){var y=this;y.customerFields=[];y.working=!1;y.password="";y.confirmPassword="";y.passwordRegex="";y.passwordRegexMessage="";y.setAsComplimentUser=!1;y.countries=[];y.smsCountryId=null;y.customerGroup=null;y.registerBtnClicked=!1;y.customerFields=h;y.passwordRegex=e.getPasswordStrengthRegex();y.passwordRegexMessage=e.getPasswordStrengthRegexMessage();y.complimentTermsUrl=s.getComplimentTermsUrl();y.nikitaSettings=s.getNikitaSettings();y.newCustomerOptions=l!==undefined&&l!==null?l:{newCustomer:!1,fields:[],type:""};y.newCustomerOptions.newCustomer&&y.newCustomerOptions.fields.length>0&&n.forEach(y.customerFields,function(t){n.forEach(y.newCustomerOptions.fields,function(n){t.name.toLowerCase()===n.key.toLowerCase()&&(t.value=n.value)})});y.departmentInfo=c.getDepartmentInfo();c.getSelectedCountries().then(function(n){y.countries=n;y.smsCountryId=y.departmentInfo.languageId;t.$broadcast("getSelectedCountry",y.countries,y.smsCountryId)});y.preferences=c.getDepartmentPreferences();y.canSetCustomerGroup=y.preferences.cust2016_AllowReservationRule=="true"&&y.preferences.custAllowSetLoginGroup=="true";y.userMustSelectGroup=y.canSetCustomerGroup&&y.preferences.customerMustSelectLoginGroup=="true";y.validateRegisterForm=function(){y.registerBtnClicked=!0;let i=!0;return t.registerForm.$invalid&&(i=!1,n.forEach(t.registerForm.$error,function(t){n.forEach(t,function(n){n.$setTouched()})})),i};y.register=function(n){var e,h,c,s;if(!y.validateRegisterForm())return!1;if(y.password!==y.confirmPassword){r.error("Passwords do not match!");return}for(y.working=!0,e={id:0,fields:{},smsCountryId:y.smsCountryId,groupId:y.customerGroup!=null?y.customerGroup.id:null},h=0;h<y.customerFields.length;h++)c=y.customerFields[h].name,s=y.customerFields[h].value,e.fields[c]=y.customerFields[h].type=="Date"&&s!=undefined&&s!=null&&s!=""?s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate():s;if(y.newCustomerOptions.newCustomer&&y.newCustomerOptions.type==="PersonalNumberAndMobile"&&!(e.fields.SSN&&e.fields.Phone2)){r.error("Personal number or mobile is missing!");y.working=!1;return}u.getDuplicatedCustomerFields(e.fields).then(function(s){var h=s.data,c,l,p;if(h.length>0&&!n){c=h.filter(function(n){return n.uniqueLevel===1});l=h.filter(function(n){return n.uniqueLevel===2});l.length>0?alert(f.instant("User_with_this_fields_already_exists")+" "+l.map(function(n){return n.caption})):c.length>0&&(p=confirm(f.instant("User_with_this_fields_already_exists")+" "+c.map(function(n){return n.caption})+". "+f.instant("Create_user_anyway")),p&&y.register(!0));y.working=!1;return}e.password=y.password;y.newCustomerOptions.newCustomer&&y.newCustomerOptions.type==="OneTimePassword"?i.registerFromOneTimePasswordLogin(e).then(function(n){v(function(){i.sendOneTimePassword(n.id).then(function(i){t.$hide();i?(r.success(f.instant("OneTime_password_sent")),a.displayLoginForm(o,{type:"OneTimePassword",hasOneTimePasswordSent:!0,customer:{id:n.id,name:n.name}})):r.error(f.instant("Error_while_sending_onetime_password"))},function(){r.error(f.instant("Error_while_sending_onetime_password"))})},1500)},function(){r.error("Error!")}).finally(function(){y.working=!1}):(y.newCustomerOptions.newCustomer&&y.newCustomerOptions.type==="LoginWithFacebook"&&y.newCustomerOptions.details&&y.newCustomerOptions.details.externalId&&(e.ExAccountDetails={ExternalId:y.newCustomerOptions.details.externalId,Provider:"facebook"}),i.register(e).then(function(){y.password="";y.confirmPassword="";t.$hide();y.nikitaSettings.isNikita&&y.setAsComplimentUser&&u.updateComplimentUser(!0).then(function(){r.success("Compliment user created")},function(){r.error("Error while updating compliment user")});o&&typeof o=="function"&&o()},function(){r.error("Error!")}).finally(function(){y.working=!1}))})}}n.module("app").controller("registerCtrl",t);t.$inject=["$scope","AuthService","toastr","UserAccountService","$translate","UtilityService","callbackFunction","NikitaService","customerFields","DepartmentService","newCustomerOptions","ModalService","$timeout"]}(window.angular),function(n){"use strict";function t(n,t){var i=this;i.resourceDescription=t;i.cancel=function(){n.dismiss("Canceled")}}n.module("app").controller("resourceDescriptionController",t);t.$inject=["$uibModalInstance","resourceDescription"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c){function a(){f.getResource(i.id).then(function(n){l.currentResource=n.data;o.getResourceFeedbacks(l.currentResource.id).then(function(n){isNaN(n.data.averageRate)||(n.data.averageRate=n.data.averageRate.toFixed(2));l.feedbackData=n.data})});l.departmentPreferences=h.getDepartmentPreferences();l.departmentNouns=h.getDepartmentNouns();l.departmentInfo=h.getDepartmentInfo()}var l=this;l.currentResource={};l.maxRate=5;l.feedbackData={averageRate:0,lastFiveFeedbacks:[]};l.departmentPreferences={};l.departmentInfo={};a();l.displayServicesInformation=function(n){s.dismiss("Canceled");r.getService(n.id,!1).then(function(n){console.log(n.data);e.displayServicesInformation(n.data)})};l.showFeedbackModal=function(n){var t=e.showFeedbackModal(n.history);t.result.then(function(){a()})};l.cancel=function(){s.dismiss("Canceled")};l.searchBookings=function(n){r.getService(n.id,!1).then(function(t){if(l.departmentPreferences.cust2016_DefaultSearchMethod=="flexduration")e.displayScheduleTimeInfo([i],t.data,null);else{var r={serviceId:n.id,isCombined:t.data.isCombined,searchType:l.departmentPreferences.cust2016_DefaultSearchMethod=="flexduration"?"quick":l.departmentPreferences.cust2016_DefaultSearchMethod,resourceId:i.id};c.go("booking",r);l.cancel()}})}}n.module("app").controller("resourceInfoCtrl",t);t.$inject=["UtilityService","$uibModal","resource","ServiceService","$scope","ResourceService","ModalService","FeedbackService","$uibModalInstance","DepartmentService","$state"]}(window.angular),function(n){"use strict";function t(t,i,r,u,f,e,o,s,h,c,l,a,v){function k(){var t,i,r;y.totalPrice=0;r=(new Date(y.weekSchedule[0].openHour.ends)-new Date(y.weekSchedule[0].openHour.starts))/6e4;n.forEach(y.bookingOptions,function(n){i=(n.endOH-n.startOH+1)*r;t=a.priceMode===1?a.pricePrHour*(i/60):a.price;y.totalPrice+=t;n.service={price:t,duration:i,id:a.id,name:a.name}})}function w(){var t=[];return n.forEach(y.bookingOptions,function(n){var s=y.weekSchedule.filter(function(t){return t.openHour.openHourId===n.startOH})[0],h=y.weekSchedule.indexOf(s),c=y.weekSchedule.filter(function(t){return t.openHour.openHourId===n.endOH})[0],l=y.weekSchedule.indexOf(c),e=new Date(y.weekSchedule[h].openHour.starts),o=new Date(y.weekSchedule[l].openHour.ends),u=new Date(n.day),i,r,f;u.setHours(e.getHours());u.setMinutes(e.getMinutes());i=new Date(n.day);i.setHours(o.getHours());i.setMinutes(o.getMinutes());y.type===2?(f=y.xDataList.filter(function(t){return t.id===n.xId})[0],r={id:f.id,name:f.title}):r={id:y.resourceList[0].id,name:y.resourceList[0].name};t.push({id:n.serviceTimeId,resourceId:r.id,resourceName:r.name,service:n.service,start:u.toISOString(),end:i.toISOString()})}),t}function d(t){var i=!1,r,u;return r=y.type===2?t[0].resourceId:y.resourceList[0].id,u=s.getItems().filter(function(n){return n._data.bookingInfo.resourceId===r&&n._data.bookingInfo.service.id===a.id}),n.forEach(u,function(r){n.forEach(t,function(n){(n.start>=r._data.bookingInfo.start&&n.start<r._data.bookingInfo.end||n.end>r._data.bookingInfo.start&&n.end<=r._data.bookingInfo.end)&&(i=!0)})}),i}function g(t){d(t)?h.error(c.instant("Item_is_already_in_the_shopping_cart")):(n.forEach(t,function(n){s.addItem(n.id,tt(n.service,n),n.service.price,1,{product:!1,bookingInfo:n})}),y.cancel())}function nt(n,t){return n.xId===t.xId?n.startOH>t.startOH?1:-1:n.xId>t.xId?1:-1}function tt(n,t){return o.getFullAvailableTimeName(n,t)}function b(n,t){return(n=n.trim(),n.length>t)?n.substring(0,t):n}var y=this,p;y.pref=r.getDepartmentPreferences();y.noun=r.getDepartmentNouns();y.selectedWeek=null;y.publishedWeeks=[];y.weekSchedule=[];y.bookingOptions=[];y.disableNext=!0;y.disablePrevious=!0;y.resourceList=l;y.service=a;y.disableContinueBtn=!0;y.totalPrice=0;y.type=v!==null&&l.length>1?2:1;y.selectedDate=v;y.xDataList=[];y.bItems=[];y.weekTranslationTxt=c.instant("ScheduleTimeInfo_Week")+" ";y.type===2?(p=[],y.resourceList!==undefined&&y.resourceList!==null?(y.resourceList=f.getResourcesForService(y.service,y.resourceList),n.forEach(y.resourceList,function(n){y.xDataList.push({id:n.id,name:b(n.name,10),title:n.name});p.push(n.id)}),i.getDaySchedule(y.selectedDate,p,y.service).then(function(n){y.weekSchedule=n.data})):f.getAllResources(!0).then(function(t){y.resourceList=f.getResourcesForService(y.service,t);n.forEach(y.resourceList,function(n){y.xDataList.push({id:n.id,name:b(n.name,10),title:n.name});p.push(n.id)});i.getDaySchedule(y.selectedDate,p,y.service).then(function(n){y.weekSchedule=n.data})})):(y.xDataList=[{id:1,name:"Man.",title:"Mandag"},{id:2,name:"Tirs.",title:"Tirsdag"},{id:3,name:"Ons.",title:"Onsdag"},{id:4,name:"Tors.",title:"Torsdag"},{id:5,name:"Fre.",title:"Fredag"},{id:6,name:"Lør.",title:"Lørdag"},{id:7,name:"Søn.",title:"Søndag"}],i.getPublishedWeeks().then(function(n){var t,r;y.publishedWeeks=n.data;y.publishedWeeks.length>0&&(y.publishedWeeks.length>1&&(y.disableNext=!1),y.selectedDate!==null?(t=y.publishedWeeks.filter(function(n){return y.selectedDate>=new Date(n.starts)&&y.selectedDate<=new Date(n.ends)}),t.length>0?(y.selectedWeek=t[0],r=y.publishedWeeks.indexOf(t[0]),y.disableNext=y.publishedWeeks.length-1<r+1,y.disablePrevious=r-1<0):y.selectedWeek=y.publishedWeeks[0]):y.selectedWeek=y.publishedWeeks[0],i.getWeekSchedule(y.selectedWeek,y.resourceList[0],y.service).then(function(n){y.weekSchedule=n.data}))}));y.getTimeBlockStyle=function(n){return n.status==3?{"background-color":"#"+y.pref.calColorUnavailable,"border-color":"#"+y.pref.calColorUnavailable}:""};y.cancel=function(){t.close(!1)};y.nextWeek=function(){if(y.bookingOptions=[],y.disableContinueBtn=!0,y.totalPrice=0,y.bItems=[],y.selectedWeek!==null){var t=y.publishedWeeks.filter(function(n){return n.week===y.selectedWeek.week&&n.year===y.selectedWeek.year})[0],n=y.publishedWeeks.indexOf(t);y.disablePrevious=!1;y.disableNext=y.publishedWeeks.length-1<n+1+1;y.publishedWeeks.length>n+1&&(y.selectedWeek=y.publishedWeeks[n+1],i.getWeekSchedule(y.selectedWeek,y.resourceList[0],y.service).then(function(n){y.weekSchedule=n.data}))}};y.previousWeek=function(){if(y.bookingOptions=[],y.disableContinueBtn=!0,y.totalPrice=0,y.bItems=[],y.selectedWeek!==null){var t=y.publishedWeeks.filter(function(n){return n.week===y.selectedWeek.week&&n.year===y.selectedWeek.year})[0],n=y.publishedWeeks.indexOf(t);y.disableNext=!1;y.disablePrevious=n-2<0;n-1>=0&&(y.selectedWeek=y.publishedWeeks[n-1],i.getWeekSchedule(y.selectedWeek,y.resourceList[0],y.service).then(function(n){y.weekSchedule=n.data}))}};y.changeWeek=function(){if(y.bookingOptions=[],y.disableContinueBtn=!0,y.totalPrice=0,y.bItems=[],y.selectedWeek!==null){var t=y.publishedWeeks.filter(function(n){return n.week===y.selectedWeek.week&&n.year===y.selectedWeek.year})[0],n=y.publishedWeeks.indexOf(t);y.disableNext=y.publishedWeeks.length-1<n+1;y.disablePrevious=n-1<0;i.getWeekSchedule(y.selectedWeek,y.resourceList[0],y.service).then(function(n){y.weekSchedule=n.data})}};y.selectOpenHour=function(t,i){var tt,v,et,u,d,g,ht;if(y.disableContinueBtn=!0,y.bItems=[],y.bookingOptions.length<=0){tt=y.weekSchedule.filter(function(n){return n.openHour.openHourId===t.openHourId})[0];v=y.weekSchedule.indexOf(tt);y.weekSchedule[v].openHourInfoDic[i.xId].selected=!0;var it=0,rt=-1,ut=-1,p=!1;n.forEach(y.xDataList,function(n){for(var t=0;t<=y.weekSchedule.length-1;t++)!p&&(y.type!==2||y.type===2&&n.id===i.xId)&&(n.id>i.xId||n.id===i.xId&&t>=v)?(y.weekSchedule[t].openHourInfoDic[n.id].status===2&&(p=!0),p||((y.weekSchedule[t].openHourInfoDic[n.id].status===1||y.weekSchedule[t].openHourInfoDic[n.id].status===0)&&(it+=1),it>a.maxDuration?y.weekSchedule[t].openHourInfoDic[n.id].disabled=!0:y.weekSchedule[t].openHourInfoDic[n.id].status===1&&(y.weekSchedule[t].openHourInfoDic[n.id].disabled=!1))):y.weekSchedule[t].openHourInfoDic[n.id].disabled=!0,y.weekSchedule[t].openHourInfoDic[n.id].status===1&&(y.type!==2||y.type===2&&n.id===i.xId)&&(rt=n.id,ut=y.weekSchedule[t].openHour.openHourId)});y.bookingOptions.push({day:i.day,xId:i.xId,startOH:t.openHourId,endOH:t.openHourId,serviceTimeId:i.id,fDisabledXIdAccMaxDu:rt,fDisabledOpenHourIdAccMaxDu:ut})}else{var f=i.xId,o=t.openHourId,ft=i.day,ct=i.id;if(f<y.bookingOptions[0].xId||f===y.bookingOptions[0].xId&&o<y.bookingOptions[0].startOH){var lt=y.bookingOptions[y.bookingOptions.length-1].xId,at=y.bookingOptions[y.bookingOptions.length-1].endOH,vt=y.bookingOptions[y.bookingOptions.length-1].day;y.bookingOptions[0].xId=f;y.bookingOptions[0].startOH=o;y.bookingOptions[0].day=ft;y.bookingOptions[0].serviceTimeId=ct;f=lt;o=at;ft=vt}et=y.bookingOptions[0];y.bookingOptions=[];y.bookingOptions.push(et);for(var b=!1,r=-1,l=-1,s=-1,h=-1,e=null,ot=!1,st=0,c=y.xDataList.length-1;c>=0;c--){for(r=y.xDataList[c].id,d=f===r?o:y.weekSchedule[y.weekSchedule.length-1].openHour.openHourId,u=y.weekSchedule.length-1;u>=0;u--)r>=y.bookingOptions[0].xId&&r<=f&&(r===y.bookingOptions[0].xId&&y.weekSchedule[u].openHour.openHourId<y.bookingOptions[0].startOH||r===f&&y.weekSchedule[u].openHour.openHourId>o||(h=y.weekSchedule[u].openHourInfoDic[r].status===3,y.bookingOptions[0].xId===r&&y.bookingOptions[0].startOH===y.weekSchedule[u].openHour.openHourId&&e===null&&y.bookingOptions[0].startOH===t.openHourId?y.bookingOptions[0].endOH=t.openHourId:y.bookingOptions[0].xId===r&&y.bookingOptions[0].startOH===y.weekSchedule[u].openHour.openHourId&&e!==null&&e.xId===y.bookingOptions[0].xId&&(y.bookingOptions[0].endOH=e.endOH),e!==null&&l!==-1&&r!==l&&l!==y.bookingOptions[0].xId&&u===y.weekSchedule.length-1&&s===!1?y.bookingOptions.push(e):e!==null&&s!==-1&&s!==h&&h===!0&&y.bookingOptions.push(e),s!==-1&&h!==-1&&s!==h&&h===!1&&(d=y.weekSchedule[u].openHour.openHourId),e={day:y.weekSchedule[0].openHourInfoDic[r].day,xId:r,startOH:y.weekSchedule[u].openHour.openHourId,endOH:d,serviceTimeId:y.weekSchedule[u].openHourInfoDic[r].id},s=y.weekSchedule[u].openHourInfoDic[r].status===3)),g=y.bookingOptions[0].xId===r?y.bookingOptions[0].startOH:1,ht=f===r?o:y.weekSchedule[y.weekSchedule.length-1].openHour.openHourId,y.weekSchedule[u].openHourInfoDic[r].selected=r>=y.bookingOptions[0].xId&&r<=f?y.weekSchedule[u].openHour.openHourId>=g&&y.weekSchedule[u].openHour.openHourId<=ht&&(y.weekSchedule[u].openHourInfoDic[r].status===1||y.weekSchedule[u].openHourInfoDic[r].status===0)?!0:!1:!1,y.bookingOptions[0].fDisabledXIdAccMaxDu===r&&y.bookingOptions[0].fDisabledOpenHourIdAccMaxDu===y.weekSchedule[u].openHour.openHourId&&(ot=!0),ot&&(y.weekSchedule[u].openHourInfoDic[r].status===1||y.weekSchedule[u].openHourInfoDic[r].status===0)&&(st+=1),(r<y.bookingOptions[0].xId&&y.type!==2||r===y.bookingOptions[0].xId&&y.weekSchedule[u].openHour.openHourId<g)&&!b&&((y.weekSchedule[u].openHourInfoDic[r].status===2||st>a.maxDuration)&&(b=!0),b||y.weekSchedule[u].openHourInfoDic[r].status!==1||(y.weekSchedule[u].openHourInfoDic[r].disabled=!1));l=r}y.bookingOptions.sort(nt);y.disableContinueBtn=!1;y.bItems=w()}k()};y.removeSelectedOpenHour=function(){y.bookingOptions=[];y.disableContinueBtn=!0;y.totalPrice=0;y.bItems=[];n.forEach(y.xDataList,function(n){for(var t=0;t<=y.weekSchedule.length-1;t++)y.weekSchedule[t].openHourInfoDic[n.id].status===1?(y.weekSchedule[t].openHourInfoDic[n.id].selected=!1,y.weekSchedule[t].openHourInfoDic[n.id].disabled=!1):y.weekSchedule[t].openHourInfoDic[n.id].status===0&&(y.weekSchedule[t].openHourInfoDic[n.id].selected=!1)})};y.ProceedToBooking=function(){var n=w();y.pref.cust2016_DefaultSearchMethod==="standard"?g(n):y.quickBooking(n)};y.quickBooking=function(n){var t=u.getAuth().isAuth;if(y.cancel(),!t)return e.displayLoginForm(function(){y.quickBooking(n)},null,n),null;e.displayConfirmPurchase(n,[])}}n.module("app").controller("scheduleTimeInfoController",t);t.$inject=["$uibModalInstance","ScheduleTimeInfoService","DepartmentService","AuthService","ResourceService","ModalService","UtilityService","ngCart","toastr","$translate","resourceList","service","selectedDate"]}(window.angular),function(n){"use strict";function t(n,t){var i=this;i.currentService=n;i.cancel=function(){t.dismiss("Canceled")}}n.module("app").controller("serviceDescriptionCtrl",t);t.$inject=["service","$uibModalInstance"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h){var c=this;c.currentService=n;c.serviceAverageRating=0;c.departmentPreferences=s.getDepartmentPreferences();c.departmentNouns=s.getDepartmentNouns();o.getServiceRating(n.id).then(function(n){isNaN(n.data)?c.serviceAverageRating=0:(n.data=n.data.toFixed(2),c.serviceAverageRating=n.data)});c.cancel=function(){t.dismiss("Canceled")};c.displayResourceInformation=function(n){c.cancel();f.displayResourceInformation(n)};c.searchBookings=function(t){var i={serviceId:n.id,isCombined:n.isCombined,searchType:c.departmentPreferences.cust2016_DefaultSearchMethod=="quick2"?"quick2":"quick",resourceId:t.id};h.go("booking",i);c.cancel()}}n.module("app").controller("serviceInfoCtrl",t);t.$inject=["service","$uibModalInstance","$aside","ResourceService","ServiceService","ModalService","UtilityService","FeedbackService","DepartmentService","$state"]}(window.angular),function(n){"use strict";function t(t,i,r,u,f,e,o,s,h){var c=this;c.allServices=[];c.allowedServices=[];c.allResources=[];c.allowedResources=[];c.waitList={before:null,ends:null,starts:null,laterThan:null,resource:null,service:null};c.datepickerOptionsEnds={minDate:c.waitList.starts};c.departmentNouns=f.getDepartmentNouns();c.departmentPreferences=f.getDepartmentPreferences();r.getAllResources().then(function(t){c.allResources=t;c.allowedResources=n.copy(c.allResources)});u.getAllBookableServices().then(function(t){c.allServices=t;c.allowedServices=n.copy(c.allServices)});c.changedSelectedResource=function(){c.allowedServices=u.getServicesForResource(c.waitList.resource,c.allServices)};c.changedSelectedService=function(){c.allowedResources=r.getResourcesForService(c.waitList.service,c.allResources)};c.dismissModal=function(){i.dismiss()};c.addToWaitList=function(){c.waitList.starts=h.convertTimezoneToUTC(c.waitList.starts);c.waitList.ends=h.convertTimezoneToUTC(c.waitList.ends);c.waitList.before!=null&&(c.waitList.before=h.convertTimezoneToUTC(c.waitList.before));c.waitList.laterThan!=null&&(c.waitList.laterThan=h.convertTimezoneToUTC(c.waitList.laterThan));t.addToWaitList(c.waitList).then(function(){o.success(s.instant("Added"));i.close("Ok")})};c.changedDateStart=function(){c.datepickerOptionsEnds.minDate=c.waitList.starts;c.waitList.starts>c.waitList.ends&&(c.waitList.ends=null)};c.changedTimeLaterThan=function(){c.waitList.laterThan>c.waitList.before&&(c.waitList.before=c.waitList.laterThan)};c.displayResourceInformation=function(n){(n===null||n===undefined)&&(n=c.searchOptionsData.selectedResource);e.displayResourceInformation(n)};c.displayServicesInformation=function(){e.displayServicesInformation(c.waitList.service)}}n.module("app").controller("waitListCtrl",t);t.$inject=["WaitListService","$uibModalInstance","ResourceService","ServiceService","DepartmentService","ModalService","toastr","$translate","UtilityService"]}(window.angular),function(n){"use strict";function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){function yt(){tt.leftCurrencySymbol="";tt.rightCurrencySymbol=" "+u.instant("Currency_symbol");try{tt.departmentPreferences.cust2016_CurrencySymbolRight!=undefined&&tt.departmentPreferences.cust2016_CurrencySymbolRight!=null&&tt.departmentPreferences.cust2016_CurrencySymbolRight.trim()!=""?(tt.leftCurrencySymbol="",tt.rightCurrencySymbol=" "+tt.departmentPreferences.cust2016_CurrencySymbolRight):tt.departmentPreferences.cust2016_CurrencySymbolLeft!=undefined&&tt.departmentPreferences.cust2016_CurrencySymbolLeft!=null&&tt.departmentPreferences.cust2016_CurrencySymbolLeft.trim()!=""&&(tt.leftCurrencySymbol=tt.departmentPreferences.cust2016_CurrencySymbolLeft+" ",tt.rightCurrencySymbol="")}catch(n){}}function pt(){tt.quick2Data.serviceDataWithServiceGroups=[];$.each(tt.serviceGroupsWithServices,function(n,t){t.services.length>0&&(tt.quick2Data.serviceDataWithServiceGroups.push({id:0,isCombined:!1,disabled:!0,name:"------ "+t.serviceGroup.name+" ------"}),$.each(t.services,function(n,t){tt.quick2Data.serviceDataWithServiceGroups.push(t)}))})}function lt(){for(var n=!1,t=0;t<tt.wizardData.availableDatesFromVisibleDates.length;t++){if(n)break;var i=new Date(tt.wizardData.availableDatesFromVisibleDates[t]),r=i.getFullYear(),u=i.getMonth(),f=i.getDate(),e=tt.wizardData.selectedDate.getFullYear(),o=tt.wizardData.selectedDate.getMonth(),s=tt.wizardData.selectedDate.getDate();r===e&&u===o&&f===s&&(n=!0)}!n&&tt.wizardData.availableDatesFromVisibleDates.length>0&&(tt.wizardData.selectedDate=new Date(tt.wizardData.availableDatesFromVisibleDates[0]))}function wt(){$.each(tt.quick2Data.weekSchedule,function(n,t){for(var r,i=1;i<=7;i++)(n==0||tt.quick2Data.xDateHeaderList[i-1].isDisabled)&&(r=t.openHourInfoDic[i].filter(function(n){return n.id>0}),tt.quick2Data.xDateHeaderList[i-1].isDisabled=r.length==0,tt.quick2Data.xDayHeaderList[i-1].isDisabled=r.length==0)})}function st(){var i,t,f,e;if(tt.quick2Data.xDateHeaderList=[],tt.quick2Data.selectedWeek!=null&&tt.quick2Data.selectedWeek.days.length==7){for(i=new Date,t=1;t<=7;t++){var n=new Date(tt.quick2Data.selectedWeek.days[t-1]),r=(n.getMonth()+1).toString(),s=r.length==1?"0"+r:r,o=n.getDate().toString().length==1?"0"+n.getDate().toString():n.getDate().toString();tt.quick2Data.xDateHeaderList.push({id:t,name:o+" "+bt(u.instant(r+"_month")),shortName:o+"/"+s,isCurrentDate:i.getFullYear()==n.getFullYear()&&i.getMonth()==n.getMonth()&&i.getDate()==n.getDate(),isDisabled:!1})}f=-1;e=tt.quick2Data.xDateHeaderList.filter(function(n){return n.isCurrentDate});e.length>0&&(f=tt.quick2Data.xDateHeaderList.indexOf(e[0]));$.each(tt.quick2Data.xDayHeaderList,function(n,t){t.isCurrentDate=n==f?!0:!1})}}function bt(n){return n.length>3?n.substr(0,3)+".":n}function at(){tt.currentPage=1;tt.working=!0;v.getAvailableTimesLastBooking().then(function(n){tt.repeatData=n.data;tt.searchOptionsData.searchType="repeat";tt.showResults=!0;tt.hideResultsFully=!1},function(){console.log("Error...")}).finally(function(){tt.working=!1})}function kt(n){tt.searchOptionsData.selectedService=n;tt.searchOptionsData.searchType="quick";tt.searchOptionsData.selectedTypeDisplayResult="list";tt.searchOptionsData.selectedResource=null;tt.allowedResources=h.getResourcesForService(tt.searchOptionsData.selectedService,tt.allResources);rt()}function ht(n){for(var i=[],t=0;t<tt.allServiceGroups.length;t++)i.push({serviceGroup:tt.allServiceGroups[t],services:c.getServicesForServiceGroup(tt.allServiceGroups[t],n)});return i}function dt(n){return k.getFullAvailableTimeName(tt.searchOptionsData.selectedService,n)}function vt(){return k.getBookingObjFromShoppingCart()}function rt(){var t,i;tt.working=!0;(tt.searchOptionsData.selectedDateFrom===null||tt.searchOptionsData.selectedDateFrom===undefined)&&(tt.searchOptionsData.selectedDateFrom=new Date);t=tt.searchOptionsData.selectedResource===null||tt.searchOptionsData.selectedResource===undefined?0:tt.searchOptionsData.selectedResource.id;i=vt();v.getAvailableTimesForService(tt.searchOptionsData.selectedDateFrom,t,tt.searchOptionsData.selectedTypeDisplayResult,tt.searchOptionsData.selectedDateTo,tt.searchOptionsData.selectedService,i).then(function(t){tt.searchOptionsData.selectedTypeDisplayResult==="list"?(tt.listData=t.data,n.forEach(tt.listData,function(n){n.service=tt.searchOptionsData.selectedService})):(tt.timeplanData=t.data,n.forEach(tt.timeplanData.availableTimes,function(n){n.service=tt.searchOptionsData.selectedService}),et=n.copy(tt.timeplanData.availableHours),ut=n.copy(tt.timeplanData.availableHoursExtendedWeek),tt.searchOptionsData.showExtendedWeekForResource=tt.timeplanData.availableResources.length===1?!0:!1,tt.searchOptionsData.showExtendedWeekForResource&&(tt.timeplanData.availableHours=ut))},function(){console.log("//ERROR")}).finally(function(){tt.working=!1;tt.hideResultsFully=!1;tt.showResults=!0})}var tt=this,it=nt.search(),ct,ft,et,ut,ot;it.bookNow==="1"&&(ct=e.getAuth().isAuth,ct?(ft=[],ft.push({id:parseInt(it.serviceTimeId),resourceId:parseInt(it.resourceId),resourceName:it.resourceName,service:{id:parseInt(it.serviceId)},start:it.start,end:it.end}),s.displayConfirmPurchase(ft,[])):s.displayLoginForm(function(){var n=[];n.push({id:parseInt(it.serviceTimeId),resourceId:parseInt(it.resourceId),resourceName:it.resourceName,service:{id:parseInt(it.serviceId)},start:it.start,end:it.end});s.displayConfirmPurchase(n,[])}));et=[];ut=[];tt.authData={};tt.showResults=!1;tt.working=!1;tt.hideResultsFully=!0;tt.screenOptions=k.getScreenOptions();tt.allResources=[];tt.allServices=[];tt.allServiceGroups=[];tt.allowedServices=[];tt.allowedResources=[];tt.workingWizardResource=!0;tt.currentPage=1;tt.currentPageFromPagination=1;tt.itemsPerPage=10;tt.selectedResource=null;tt.displayTypesOptions=[];tt.bacgroundColorsBookingBlocks={};tt.serviceGroupsWithServices=[];tt.repeatData=[];tt.listData=null;tt.timeplanData={resourceList:[],availableHours:[],availableHoursExtendedWeek:[],blocksPerHour:"",durationSingleService:"",availableTimes:[],blockTimeDuration:"",numberOfTimeBlocksInSelectedService:"",resourcesUsedNotThisService:[],futureBookingsOfThisCustomer:[],availableDates:[]};tt.searchOptionsData={searchType:"standard",timeplanOrientation:"vertical",selectedTypeDisplayResult:"list",selectedService:null,selectedResource:null,selectedServiceGroup:null,selectedDateFrom:new Date,selectedDateTo:null,showExtendedWeekForResource:!1,availableDatesFromVisibleDates:[],datepickerOptions:{minDate:new Date,maxMode:"day",visibleDates:[],dateDisabled:function(n){var t,i;if(n.mode!=="day"||tt.searchOptionsData.selectedService===null)return!1;for(t=0;t<tt.searchOptionsData.availableDatesFromVisibleDates.length;t++)if(i=new Date(tt.searchOptionsData.availableDatesFromVisibleDates[t]),i.getYear()===n.date.getYear()&&i.getMonth()===n.date.getMonth()&&i.getDate()===n.date.getDate())return!1;return!0}}};d.$watch("bc.searchOptionsData.datepickerOptions.visibleDates",function(){if(tt.searchOptionsData.selectedService!=null&&tt.searchOptionsData.datepickerOptions.visibleDates.length!==0){var n={services:[tt.searchOptionsData.selectedService],resource:tt.searchOptionsData.selectedResource===null?{id:0}:tt.searchOptionsData.selectedResource,availableResources:tt.allowedResources,visibleDates:tt.searchOptionsData.datepickerOptions.visibleDates,selectedDate:tt.searchOptionsData.selectedDateFrom};v.getFreeDatesInDateRange(n).then(function(n){tt.searchOptionsData.availableDatesFromVisibleDates=n.data;d.$broadcast("refreshDatepickers")}).finally(function(){})}});tt.wizardData={services:[],upsaledServices:[],resource:null,selectedDate:null,selectedListOfTimes:null,availableListOfTimes:[],availableResources:[],availableServices:[],allResourceCategories:[],availableServiceGroupsWithServices:[],requireResource:!0,order:"service",recommendations:{services:[],serviceGroupsWithServices:[],products:[]},availableDatesFromVisibleDates:[],datepickerOptions:{minDate:new Date,maxMode:"day",visibleDates:[],tableClass:"my-margin-auto",showDatesInMonthOnly:!0,dateDisabled:function(n){var t,i;if(n.mode!=="day"||tt.wizardData.resource===null||tt.wizardData.services.length===0)return!1;for(t=0;t<tt.wizardData.availableDatesFromVisibleDates.length;t++)if(i=new Date(tt.wizardData.availableDatesFromVisibleDates[t]),i.getYear()===n.date.getYear()&&i.getMonth()===n.date.getMonth()&&i.getDate()===n.date.getDate())return!1;return!0}},hasSetSelectedTimeFromVipps:!1};tt.quick2Data={selectedService:null,selectedResource:null,selectedWeek:null,weekSchedule:[],xDayHeaderList:[],xDateHeaderList:[],publishedWeeks:[],disableNext:!0,disablePrevious:!0,serviceDataWithServiceGroups:[]};d.$on("wizard:stepChanged",function(){$("html,body").scrollTop(0)});d.$watch("bc.wizardData.datepickerOptions.visibleDates",function(){if(tt.wizardData.resource!=null){tt.workingWizardDate=!0;var n={services:tt.wizardData.services,resource:tt.wizardData.resource,availableResources:tt.wizardData.availableResources,visibleDates:tt.wizardData.datepickerOptions.visibleDates,selectedDate:tt.wizardData.selectedDate};v.getFreeDatesInDateRange(n).then(function(n){tt.wizardData.availableDatesFromVisibleDates=n.data;d.$broadcast("refreshDatepickers")}).finally(function(){tt.workingWizardDate=!1})}});tt.authData=e.getAuth();h.getAllResources().then(function(t){tt.allResources=t;tt.allowedResources=n.copy(tt.allResources);tt.wizardData.availableResources=tt.wizardData.services.length>0?h.getResourcesForServices(tt.wizardData.services,tt.allResources):t;tt.workingWizardResource=!1});tt.departmentPreferences=o.getDepartmentPreferences();tt.departmentPreferences.cust2016_DefaultSearchMethod=="wizard"&&(i.wizardOrder!==undefined&&i.wizardOrder!==null&&i.wizardOrder!=""?tt.wizardData.order=i.wizardOrder:tt.departmentPreferences.cust2016_WizardSearchOrder=="resource"&&(tt.wizardData.order="resource"));tt.departmentNouns=o.getDepartmentNouns();c.getAllBookableServices().then(function(t){tt.allServices=t;tt.wizardData.availableServices=t;tt.allowedServices=n.copy(tt.allServices);tt.allowedServices.length==1&&(tt.searchOptionsData.selectedService=tt.allowedServices[0]);f.getAllServiceGroups().then(function(t){tt.allServiceGroups=t;y(function(){tt.serviceGroupsWithServices=ht(tt.allServices);tt.wizardData.availableServiceGroupsWithServices=ht(tt.allServices);n.forEach(tt.serviceGroupsWithServices,function(n){n.serviceGroup.selectedCurrent=0})})})});tt.departmentInfo=o.getDepartmentInfo();tt.searchOptionsData.timeplanOrientation=k.getTimeplanOrientation();tt.displayTypesOptions=k.getDisplayTypesOptions();tt.bacgroundColorsBookingBlocks=k.getBackgroundColorsBookingBlocks();tt.searchOptionsData.selectedTypeDisplayResult=k.getDefaultDisplayType();yt();ot=tt.departmentPreferences.cust2016_BookingWithoutPassword!=""&&(tt.departmentPreferences.cust2016_EnablePaymentSystem=="false"||tt.departmentPreferences.cust2016_EnablePaymentSystem=="true"&&tt.departmentPreferences.cust2016_EnableKlippekortPaymentMethod=="false"&&tt.departmentPreferences.cust2016_EnableGavekortPaymentMethod=="false"&&tt.departmentPreferences.cust2016_EnableVippsPaymentMethod=="false"&&tt.departmentPreferences.cust2016_EnableInvoicePaymentMethod=="false"&&tt.departmentPreferences.cust2016_EnableKlarnaPaymentMethod=="false");tt.departmentPreferences.cust2016_DefaultSearchMethod=="wizard"&&tt.departmentPreferences.cust2016_ShowResourceCategoryUnderResName=="true"&&h.getResourceCategories().then(function(n){tt.wizardData.allResourceCategories=n.data});y(function(){d.$apply(function(){tt.departmentPreferences.cust2016_SearchShowServiceFirst==="true"?($('.sortable-serice-resource-booking>div[data-name="serviceGroup"]').data("index",1),$('.sortable-serice-resource-booking>div[data-name="service"]').data("index",2),$('.sortable-serice-resource-booking>div[data-name="resource"]').data("index",3)):($('div.sortable-serice-resource-booking>div[data-name="serviceGroup"]').data("index",2),$('div.sortable-serice-resource-booking>div[data-name="service"]').data("index",3),$('div.sortable-serice-resource-booking>div[data-name="resource"]').data("index",1));$(".sortable-serice-resource-booking").each(function(){var n=$(this);n.append(n.find(".row").get().sort(function(n,t){return $(n).data("index")-$(t).data("index")}))})})});i.searchType!==undefined&&(i.searchType==="repeat"?tt.authData.isAuth?at():console.log("User must be logged in to use repeat booking service"):i.searchType==="quick"?i.serviceId!==undefined&&i.isCombined!==undefined&&c.getService(i.serviceId,i.isCombined).then(function(n){tt.searchOptionsData.searchType="quick";tt.searchOptionsData.selectedTypeDisplayResult="list";i.startDate!==undefined&&(tt.searchOptionsData.selectedDateFrom=k.convertTimezoneToUTC(i.startDate));tt.searchOptionsData.selectedService=n.data;i.resourceId!==undefined?h.getResource(i.resourceId).then(function(n){tt.searchOptionsData.selectedResource=n.data;rt()},function(){console.log("Resource with id "+i.resourceId+" does not exist.")}):(tt.searchOptionsData.selectedResource=null,rt())},function(){console.log("Service with id "+i.serviceId+" and isCombined:"+i.isCombined+" does not exist.")}):i.searchType==="quick2"?i.serviceId!==undefined&&i.isCombined!==undefined&&c.getService(i.serviceId,i.isCombined).then(function(t){i.resourceId!==undefined?h.getResource(i.resourceId).then(function(n){tt.viewCalenderData(t.data,n.data)},function(){console.log("Resource with id "+i.resourceId+" does not exist.")}):!tt.allResources||tt.allResources.length<=0?h.getAllResources().then(function(i){tt.allResources=i;tt.allowedResources=n.copy(tt.allResources);tt.viewCalenderData(t.data,null)}):tt.viewCalenderData(t.data,null)},function(){console.log("Service with id "+i.serviceId+" and isCombined:"+i.isCombined+" does not exist.")}):i.searchType==="standard"?(tt.departmentPreferences.cust2016_DefaultSearchMethod==="standard"||tt.departmentPreferences.cust2016_DefaultSearchMethod==="quick")&&i.serviceId!==undefined&&i.isCombined!==undefined&&(c.getService(i.serviceId,i.isCombined).then(function(n){tt.searchOptionsData.searchType=tt.departmentPreferences.cust2016_DefaultSearchMethod;tt.searchOptionsData.selectedTypeDisplayResult=tt.displayTypesOptions.indexOf(i.displayType)===-1?tt.searchOptionsData.selectedTypeDisplayResult:i.displayType;i.startDate!==undefined&&(tt.searchOptionsData.selectedDateFrom=k.convertTimezoneToUTC(i.startDate));tt.searchOptionsData.selectedService=n.data;i.resourceId!==undefined?h.getResource(i.resourceId).then(function(n){tt.searchOptionsData.selectedResource=n.data;rt()},function(){console.log("Resource with id "+i.resourceId+" does not exist.")}):(tt.searchOptionsData.selectedResource=null,rt())},function(){console.log("Service with id "+i.serviceId+" and isCombined:"+i.isCombined+" does not exist.")}),y(function(){tt.allowedServices=c.getServicesForResource(tt.searchOptionsData.selectedResource,tt.allServices);tt.allowedResources=h.getResourcesForService(tt.searchOptionsData.selectedService,tt.allResources)},1e3)):i.searchType==="wizard"&&i.serviceId!==undefined&&i.isCombined!==undefined&&c.getService(i.serviceId,i.isCombined).then(function(t){tt.wizardData.services.push(t.data);!tt.allResources||tt.allResources.length<=0?h.getAllResources().then(function(t){tt.allResources=t;tt.allowedResources=n.copy(tt.allResources);tt.wizardData.availableResources=t;tt.workingWizardResource=!1;tt.setWizardData()}):tt.setWizardData()}));tt.getResourceCategoryName=function(n){var i="",t;return tt.wizardData.allResourceCategories&&n&&n>0&&(t=tt.wizardData.allResourceCategories.find(function(t){return t.id===n}),t&&(i=t.name)),i};tt.setWizardData=function(){var n,t;tt.wizardData.availableResources=h.getResourcesForServices(tt.wizardData.services,tt.allResources);i.resourceId!==undefined?(n=tt.wizardData.availableResources.find(function(n){return n.id===i.resourceId}),n&&(tt.wizardData.requireResource=!0,tt.wizardData.resource=n,tt.selectedResource=n)):(tt.wizardData.requireResource=!1,tt.wizardData.resource={id:0,name:u.instant("First_available")});tt.wizardData.selectedDate=new Date;tt.workingWizardDate=!1;t={services:tt.wizardData.services,resource:tt.wizardData.resource,availableResources:tt.wizardData.availableResources,visibleDates:tt.wizardData.datepickerOptions.visibleDates,selectedDate:tt.wizardData.selectedDate,loginid:tt.authData.loginid,canChangeStartEndDate:!0};v.getFreeDatesInDateRange(t).then(function(n){tt.wizardData.availableDatesFromVisibleDates=n.data;lt();d.$broadcast("refreshDatepickers")}).finally(function(){tt.updateFreeTimesForWizardData();tt.workingWizardDate=!1});y(function(){r.wizard("advancedBooking").goTo(u.instant("Time"))},300)};tt.searchBookings=function(){tt.searchOptionsData.searchType=tt.departmentPreferences.cust2016_DefaultSearchMethod==="quick"?"quick":"standard";rt();tt.currentPageFromPagination=1};tt.displayResourceInformation=function(n){(n===null||n===undefined)&&(n=tt.searchOptionsData.selectedResource);s.displayResourceInformation(n)};tt.displayServicesInformation=function(n){n?s.displayServicesInformation(n):s.displayServicesInformation(tt.searchOptionsData.selectedService)};tt.displayServiceDescription=function(n){n&&s.displayServiceDescription(n)};tt.displayWaitListInfoModal=function(){s.displayWaitListInfoModal()};tt.displayBookingInfoModal=function(n){var t=s.displayBookingInfoModal(n);t.result.then(function(){rt()})};tt.displayActivityInfoModal=function(n){var t=s.displayActivityInfoModal(n);t.result.then(function(){rt()})};tt.changedSelectedResource=function(){tt.allowedServices=c.getServicesForResource(tt.searchOptionsData.selectedResource,tt.allServices)};tt.changedSelectedService=function(){tt.allowedResources=h.getResourcesForService(tt.searchOptionsData.selectedService,tt.allResources)};tt.changedSelectedServiceGroup=function(){if(tt.searchOptionsData.selectedService=null,tt.allowedResource=n.copy(tt.allResources),tt.searchOptionsData.selectedResource!=null){var t=c.getServicesForServiceGroup(tt.searchOptionsData.selectedServiceGroup,tt.allServices);tt.allowedServices=c.getServicesForResource(tt.searchOptionsData.selectedResource,t)}else tt.allowedServices=c.getServicesForServiceGroup(tt.searchOptionsData.selectedServiceGroup,tt.allServices)};tt.changedPaginationPage=function(){$("#resultsTable").fadeOut(function(){tt.currentPage=tt.currentPageFromPagination;d.$apply();$("#resultsTable").fadeIn()})};tt.getProductFromCart=function(n){var t=w.getItemById(n.id);return t===!1||t.getData().product===!0?!1:t.getData().bookingInfo.service.id===tt.searchOptionsData.selectedService.id?t:!1};tt.addToShoppingCart=function(n){var t=0;tt.departmentPreferences.cust2016_ShowServicePrice==="showAll"&&(t=tt.searchOptionsData.selectedService.price);w.addItem(n.id,dt(n),t,1,{product:!1,bookingInfo:n});rt()};tt.getTotalItemsFromCart=function(){return w.getTotalItems()};tt.removeFromShoppingCart=function(n){w.removeItemById(n.id);rt()};tt.getColspanHours=function(){return tt.timeplanData.blocksPerHour>1?tt.timeplanData.blocksPerHour:1};tt.getColspanMinutes=function(){return tt.timeplanData.blocksPerHour<1?1/tt.timeplanData.blocksPerHour:1};tt.generateBlocksNumber=function(){for(var i=tt.timeplanData.availableHours.length*tt.timeplanData.blocksPerHour,t=[],n=0;n<i;n++)t.push(n);return t};tt.getMinuteValue=function(n){var t=n*tt.timeplanData.blockTimeDuration%60;return t===0&&(t="00"),t};tt.getHoursValue=function(n){return tt.timeplanData.availableHours[parseInt(n/tt.getColspanHours())]};tt.getAvailableTimeForBlock=function(n,t,i){var it=parseInt(t/tt.getColspanHours()),rt=t/tt.getColspanMinutes(),p=tt.timeplanData.availableHours[it],w=tt.getMinuteValue(rt),f=new Date(i),k,d,g,r;(i===null||i===undefined)&&(f=tt.searchOptionsData.selectedDateFrom);var o=vt(),u=new Date(f.getFullYear(),f.getMonth(),f.getDate(),p,w,0).getTime(),s=new Date(f.getFullYear(),f.getMonth(),f.getDate(),p,w+tt.timeplanData.blockTimeDuration,0).getTime();for(r=0;r<o.length;r++){var l=new Date(o[r].start).getTime(),a=new Date(o[r].end).getTime(),ut=o[r].resourceId;if(u>=l&&u<a&&ut===n){var e=o[r],h=e.service.duration/tt.timeplanData.blockTimeDuration*tt.getColspanMinutes(),b=h!==tt.getColspanMinutes();return u===l&&s!==a?{time:e,ngclass:"my-clickable-table-block",show:b,customStyle:{"background-color":tt.bacgroundColorsBookingBlocks.info},colspan:h,text:e.service.name,typeOfBlock:"shoppingCart"}:u===l&&s===a?{time:e,ngclass:"my-clickable-table-block",customStyle:{"background-color":tt.bacgroundColorsBookingBlocks.info},show:!b,colspan:h,text:e.service.name,typeOfBlock:"shoppingCart"}:{time:e,ngclass:"my-clickable-table-block",customStyle:{"background-color":tt.bacgroundColorsBookingBlocks.info},show:!1,colspan:h,text:"",typeOfBlock:"shoppingCart"}}}for(r=0;r<tt.timeplanData.availableTimes.length;r++)if(k=new Date(tt.timeplanData.availableTimes[r].start).getTime(),d=tt.timeplanData.availableTimes[r].resourceId,k===u&&d===n)return g=tt.timeplanData.availableTimes[r],{time:g,ngclass:"my-clickable-table-block",customStyle:{"background-color":tt.bacgroundColorsBookingBlocks.success},show:!0,colspan:tt.getColspanMinutes(),typeOfBlock:"available"};for(r=0;r<tt.timeplanData.futureBookingsOfThisCustomer.length;r++){var v=new Date(tt.timeplanData.futureBookingsOfThisCustomer[r].starts).getTime(),y=new Date(tt.timeplanData.futureBookingsOfThisCustomer[r].ends).getTime(),ft=tt.timeplanData.futureBookingsOfThisCustomer[r].resourceId,c=tt.timeplanData.futureBookingsOfThisCustomer[r].durationMinutes/tt.timeplanData.blockTimeDuration*tt.getColspanMinutes(),nt=c!==tt.getColspanMinutes();if(u>=v&&u<y&&ft===n)return u===v&&s!==y?{time:tt.timeplanData.futureBookingsOfThisCustomer[r],ngclass:"my-clickable-table-block",customStyle:{"background-color":tt.bacgroundColorsBookingBlocks.primary},show:nt,colspan:c,text:tt.timeplanData.futureBookingsOfThisCustomer[r].serviceName,typeOfBlock:"futureBooking"}:u===v&&s===y?{time:tt.timeplanData.futureBookingsOfThisCustomer[r],ngclass:"my-clickable-table-block",customStyle:{"background-color":tt.bacgroundColorsBookingBlocks.primary},show:!nt,colspan:c,text:tt.timeplanData.futureBookingsOfThisCustomer[r].serviceName,typeOfBlock:"futureBooking"}:{time:null,customStyle:{"background-color":tt.bacgroundColorsBookingBlocks.primary},ngclass:"my-clickable-table-block",show:!1,typeOfBlock:"futureBooking",colspan:c,text:""}}return{time:null,ngclass:"my-non-clickable-table-block",customStyle:{"background-color":tt.bacgroundColorsBookingBlocks.danger},show:!0,colspan:tt.getColspanMinutes(),typeOfBlock:"unavailable"}};tt.bookTimeplanBlock=function(n){if(n.time!==null){if(tt.departmentPreferences.cust2016_DefaultSearchMethod==="quick"&&n.typeOfBlock==="available"){tt.finishQuickBooking(n.time);return}n.typeOfBlock==="futureBooking"?tt.displayActivityInfoModal(n.time):tt.displayBookingInfoModal(n.time)}};tt.changeTimeplanDateNextPrevious=function(n){var t=new Date(tt.searchOptionsData.selectedDateFrom);n==="previous"?t.setDate(tt.searchOptionsData.selectedDateFrom.getDate()-1):t.setDate(tt.searchOptionsData.selectedDateFrom.getDate()+1);tt.searchOptionsData.selectedDateFrom=t;tt.searchBookings()};tt.showOptionsPage=function(){y(function(){tt.hideResultsFully=!0},500);tt.showResults=!1};tt.getResourceTakenCustomStyle=function(n){var t=n.ngclass;return t==="my-non-clickable-table-block"?{"background-color":tt.bacgroundColorsBookingBlocks.customGrey}:n.customStyle};tt.showOrHideExtendedWeek=function(){tt.searchOptionsData.showExtendedWeekForResource=!tt.searchOptionsData.showExtendedWeekForResource;tt.timeplanData.availableHours=tt.searchOptionsData.showExtendedWeekForResource?ut:et};tt.displayQuickBooking=kt;tt.openRepeatResultPage=at;tt.finishQuickBooking=function(n){var r=tt.authData.isAuth,t,i;if(!r)return s.displayLoginForm(function(){tt.finishQuickBooking(n)},null,[n],ot),null;t=[n];i=[];s.displayConfirmPurchase(t,i)};tt.finishRepeatBooking=function(n){for(var i=[],t=0;t<n.length;t++)n[t].service.isCombined=!1,i.push({id:n[t].time.id,service:n[t].service,start:n[t].time.starts,end:n[t].time.ends,resourceName:n[t].resource.name});s.displayConfirmPurchase(i,[])};tt.convertMinToHourAndMin=function(n){return k.convertMinToHourAndMin(n)};tt.getTotalDurationWizardData=function(){for(var t=0,n=0;n<tt.wizardData.services.length;n++)t+=parseInt(tt.wizardData.services[n].duration);return k.convertMinToHourAndMin(t)};tt.getTotalPriceWizardData=function(){for(var t=0,n=0;n<tt.wizardData.services.length;n++)t+=parseInt(tt.wizardData.services[n].price);return t};tt.addOrRemoveServiceFromWizardData=function(n,t,i,u){if(r.wizard("advancedBooking").resetStepsHigherThenCurrent(),tt.wizardData.order=="service"&&(tt.wizardData.resource=null),tt.wizardData.selectedDate=null,tt.wizardData.selectedListOfTimes=null,n)i!==undefined&&i!==null&&i.selectedCurrent++,u&&tt.wizardData.upsaledServices.push(t),tt.wizardData.services.push(t);else{i!==undefined&&i!==null&&i.selectedCurrent--;for(var f=0;f<tt.wizardData.services.length;f++)tt.wizardData.services[f].id===t.id&&tt.wizardData.services[f].isCombined===t.isCombined&&(u&&tt.wizardData.upsaledServices.splice(f,1),tt.wizardData.services.splice(f,1))}tt.wizardData.order=="service"&&(tt.wizardData.availableResources=h.getResourcesForServices(tt.wizardData.services,tt.allResources))};tt.checkIfServiceIsSelectedFromWizardData=function(n){for(var i=!1,t=0;t<tt.wizardData.services.length;t++)tt.wizardData.services[t].id===n.id&&tt.wizardData.services[t].isCombined===n.isCombined&&(i=!0);return i};tt.finishWizardStep=function(t,i){var e,p,u,f;if(t==="services"){if(tt.wizardData.recommendations.serviceGroupsWithServices=[],tt.wizardData.recommendations.services=[],tt.wizardData.recommendations.products=[],tt.wizardData.firstlyPickedServicesBackup=n.copy(tt.wizardData.services),tt.wizardData.order=="resource"){tt.wizardData.selectedDate==null&&(tt.wizardData.selectedDate=new Date);tt.workingWizardDate=!0;e={services:tt.wizardData.services,resource:tt.wizardData.resource,availableResources:tt.wizardData.availableResources,visibleDates:tt.wizardData.datepickerOptions.visibleDates,selectedDate:tt.wizardData.selectedDate,loginid:tt.authData.loginid,canChangeStartEndDate:!0};v.getFreeDatesInDateRange(e).then(function(n){tt.wizardData.availableDatesFromVisibleDates=n.data;lt();d.$broadcast("refreshDatepickers")}).finally(function(){tt.updateFreeTimesForWizardData();tt.workingWizardDate=!1});tt.finishWizardStep("dateAndTime");return}if(tt.departmentPreferences.cust2016_EnableRecommendations==="false"){tt.finishWizardStep("recommendation",null);return}var o=tt.wizardData.services,s=k.getProductsFromShoppingCart(),h=[],l=[],a=[];for(u=0;u<s.length;u++)p=s[u],a.push(p.getId());for(u=0;u<o.length;u++)f=o[u],f.isCombined?l.push(f.id):h.push(f.id);k.getRecommendations(h,l,a).then(function(n){var t,i;for(tt.wizardData.recommendations.services=n.data.services,tt.wizardData.recommendations.products=n.data.products,t=0;t<tt.allServiceGroups.length;t++)i=c.getServicesForServiceGroup(tt.allServiceGroups[t],tt.wizardData.recommendations.services),i.length>0&&tt.wizardData.recommendations.serviceGroupsWithServices.push({serviceGroup:tt.allServiceGroups[t],services:i});if(tt.wizardData.recommendations.services.length===0){tt.finishWizardStep("recommendation",null);return}g.sendAnalytics("booking/upsale");y(function(){r.wizard("advancedBooking").next()})})}else if(t==="recommendation"){if(tt.departmentPreferences.cust2016_showResourceInSearch==="false"&&tt.wizardData.recommendations.services&&tt.wizardData.recommendations.services.length>0){tt.finishWizardStep("resource","first_free");return}if(tt.wizardData.firstlyPickedServicesBackup=[],tt.wizardData.recommendations.serviceGroupsWithServices=[],tt.wizardData.recommendations.services=[],tt.wizardData.recommendations.products=[],tt.departmentPreferences.cust2016_showResourceInSearch==="false"){tt.finishWizardStep("resource","first_free");return}if(tt.wizardData.availableResources.length===1){r.wizard("advancedBooking").next();tt.finishWizardStep("resource",tt.wizardData.availableResources[0]);return}g.sendAnalytics("booking/Resource");r.wizard("advancedBooking").next()}else t==="resource"?(g.sendAnalytics("booking/DateAndTime"),tt.setWizardDataResource(i),y(function(){r.wizard("advancedBooking").next()},300)):t==="dateAndTime"?r.wizard("advancedBooking").next():t==="checkout"&&r.wizard("advancedBooking").next()};tt.reachedMaximumNumberOfServicesInGroup=function(n,t){return t?!1:n.selectedMax===0?!1:n.selectedCurrent>=n.selectedMax?!0:!1};tt.setWizardDataResource=function(n){if(r.wizard("advancedBooking").resetStepsHigherThenCurrent(),tt.wizardData.selectedListOfTimes=null,tt.wizardData.availableListOfTimes=[],n==undefined){tt.wizardData.selectedDate=null;tt.wizardData.resource=null;return}if(tt.workingWizardDate=!0,n==="first_free"?(tt.wizardData.requireResource=!1,tt.wizardData.resource={id:0,name:u.instant("First_available")}):(tt.wizardData.requireResource=!0,tt.wizardData.resource=n),tt.wizardData.order=="resource"){tt.wizardData.availableServices=c.getServicesForResource(n,tt.allServices);tt.wizardData.availableServiceGroupsWithServices=ht(tt.wizardData.availableServices);return}tt.wizardData.selectedDate==null&&(tt.wizardData.selectedDate=new Date);var t={services:tt.wizardData.services,resource:tt.wizardData.resource,availableResources:tt.wizardData.availableResources,visibleDates:tt.wizardData.datepickerOptions.visibleDates,selectedDate:tt.wizardData.selectedDate,loginid:tt.authData.loginid,canChangeStartEndDate:!0};v.getFreeDatesInDateRange(t).then(function(n){var t,i;for(tt.wizardData.availableDatesFromVisibleDates=n.data,t=!1,i=0;i<tt.wizardData.availableDatesFromVisibleDates.length;i++){if(t)break;var r=new Date(tt.wizardData.availableDatesFromVisibleDates[i]),u=r.getFullYear(),f=r.getMonth(),e=r.getDate(),o=tt.wizardData.selectedDate.getFullYear(),s=tt.wizardData.selectedDate.getMonth(),h=tt.wizardData.selectedDate.getDate();u===o&&f===s&&e===h&&(t=!0)}!t&&tt.wizardData.availableDatesFromVisibleDates.length>0&&(tt.wizardData.selectedDate=new Date(tt.wizardData.availableDatesFromVisibleDates[0]));d.$broadcast("refreshDatepickers")}).finally(function(){tt.updateFreeTimesForWizardData();tt.workingWizardDate=!1})};tt.updateFreeTimesForWizardData=function(){r.wizard("advancedBooking").resetStepsHigherThenCurrent();tt.workingWizardTime=!0;tt.wizardData.hasSetSelectedTimeFromVipps?tt.wizardData.hasSetSelectedTimeFromVipps=!1:tt.wizardData.selectedListOfTimes=null;tt.wizardData.availableListOfTimes=null;tt.wizardData.selectedDate=k.convertTimezoneToUTC(tt.wizardData.selectedDate);v.getAvailableStartTimesForDate(tt.wizardData).then(function(n){tt.wizardData.availableListOfTimes=n.data}).finally(function(){tt.workingWizardTime=!1})};tt.selectedTimeWizardData=function(n){r.wizard("advancedBooking").resetStepsHigherThenCurrent();tt.wizardData.selectedListOfTimes=n};tt.finishWizard=function(){for(var t,i,r,n=0;n<tt.wizardData.services.length;n++)for(tt.wizardData.selectedListOfTimes[n].service=tt.wizardData.services[n],tt.wizardData.selectedListOfTimes[n].isUpsale=!1,t=0;t<tt.wizardData.upsaledServices.length;t++)tt.wizardData.upsaledServices[t].id===tt.wizardData.services[n].id&&tt.wizardData.upsaledServices[t].isCombined===tt.wizardData.services[n].isCombined&&(tt.wizardData.selectedListOfTimes[n].isUpsale=!0);if(!tt.authData.isAuth){i={requireResource:tt.wizardData.requireResource};s.displayLoginForm(tt.finishWizard,i,tt.wizardData.selectedListOfTimes,ot);return}r=s.displayConfirmPurchase(tt.wizardData.selectedListOfTimes,[],tt.wizardData.requireResource)};tt.getEndDate=function(n){return n.length===0?new Date:n[n.length-1].end};tt.viewCalenderData=function(n,t){tt.working=!0;tt.searchOptionsData.searchType="quick2";tt.quick2Data.selectedService=n;tt.quick2Data.selectedResource=t;tt.quick2Data.selectedWeek=null;tt.quick2Data.weekSchedule=[];tt.quick2Data.xDayHeaderList=[];tt.quick2Data.xDateHeaderList=[];tt.quick2Data.publishedWeeks=[];tt.quick2Data.disableNext=!0;tt.quick2Data.disablePrevious=!0;tt.allowedResources=h.getResourcesForService(tt.quick2Data.selectedService,tt.allResources);tt.allowedResources.length==1&&tt.quick2Data.selectedResource==null&&(tt.quick2Data.selectedResource=tt.allowedResources[0]);tt.quick2Data.xDayHeaderList=[];for(var i=1;i<=7;i++)tt.quick2Data.xDayHeaderList.push({id:i,name:u.instant(i+"_day"),isCurrentDate:!1,isDisabled:!1});pt();v.getPublishedWeeks(n,tt.quick2Data.selectedResource!=null?[tt.quick2Data.selectedResource]:tt.allowedResources).then(function(n){tt.quick2Data.publishedWeeks=n.data;tt.quick2Data.publishedWeeks.length>0?(tt.quick2Data.publishedWeeks.length>1&&(tt.quick2Data.disableNext=!1),tt.quick2Data.selectedWeek=tt.quick2Data.publishedWeeks[0],st(),tt.getQuick2SearchData(1)):(tt.working=!1,tt.hideResultsFully=!1,tt.showResults=!0,tt.quick2Data.weekSchedule=[])})};tt.viewCalenderDataForResourceOrServiceCtrls=function(n){n==1&&(tt.allowedResources=h.getResourcesForService(tt.quick2Data.selectedService,tt.allResources),tt.allowedResources.length==1&&(tt.quick2Data.selectedResource=tt.allowedResources[0]));tt.viewCalenderData(tt.quick2Data.selectedService,tt.quick2Data.selectedResource)};tt.nextWeek=function(){if(tt.quick2Data.selectedWeek!==null){var t=tt.quick2Data.publishedWeeks.filter(function(n){return n.week===tt.quick2Data.selectedWeek.week&&n.year===tt.quick2Data.selectedWeek.year})[0],n=tt.quick2Data.publishedWeeks.indexOf(t);tt.quick2Data.disablePrevious=!1;tt.quick2Data.disableNext=tt.quick2Data.publishedWeeks.length-1<n+2;tt.quick2Data.publishedWeeks.length>n+1&&(tt.working=!0,tt.quick2Data.selectedWeek=tt.quick2Data.publishedWeeks[n+1],st(),tt.getQuick2SearchData(2))}};tt.previousWeek=function(){if(tt.quick2Data.selectedWeek!==null){var t=tt.quick2Data.publishedWeeks.filter(function(n){return n.week===tt.quick2Data.selectedWeek.week&&n.year===tt.quick2Data.selectedWeek.year})[0],n=tt.quick2Data.publishedWeeks.indexOf(t);tt.quick2Data.disableNext=!1;tt.quick2Data.disablePrevious=n-2<0;n-1>=0&&(tt.working=!0,tt.quick2Data.selectedWeek=tt.quick2Data.publishedWeeks[n-1],st(),tt.getQuick2SearchData(2))}};tt.bookQuick2Block=function(t,i){var s=document.querySelectorAll(".popover"),r,f,e,u,o;n.forEach(s,function(t){n.element(t).scope().isOpen=!1});r=new Date(i.day);f=new Date(t.openHour.starts);r.setHours(f.getHours());r.setMinutes(f.getMinutes());e=new Date(i.day);u=new Date(t.openHour.ends);e.setHours(u.getHours());e.setMinutes(u.getMinutes());o={id:i.id,resourceId:i.resource.id,resourceName:i.resource.name,service:tt.quick2Data.selectedService,end:u,start:r};tt.finishQuickBooking(o);return};tt.getQuick2SearchData=function(n){tt.quick2Data.weekSchedule=[];n==1&&(tt.allowedResources=h.getResourcesForService(tt.quick2Data.selectedService,tt.allResources),tt.allowedResources.length==1&&(tt.quick2Data.selectedResource=tt.allowedResources[0]));tt.quick2Data.selectedService!=null&&tt.quick2Data.selectedWeek!=null?(tt.working||(tt.working=!0),v.getQuick2SearchData(tt.quick2Data.selectedWeek.week,tt.quick2Data.selectedWeek.year,tt.quick2Data.selectedService,tt.quick2Data.selectedResource!=null?tt.quick2Data.selectedResource.id:0).then(function(n){tt.quick2Data.weekSchedule=n.data;wt()},function(){console.log("//ERROR")}).finally(function(){tt.working=!1;tt.hideResultsFully=!1;tt.showResults=!0})):tt.quick2Data.weekSchedule=[]}}n.module("app").controller("bookingCtrl",t);t.$inject=["$window","$stateParams","WizardHandler","$translate","ServiceGroupService","AuthService","DepartmentService","ModalService","ResourceService","ServiceService","$aside","$uibModal","BookingService","$timeout","$animate","ngCart","$filter","UtilityService","$scope","AnalyticService","$location","localStorageService","ExternalLoginService"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c,l){var a=this,v;a.waitingForPayment=!1;a.$onInit=function(){c&&(a.waitingForPayment=!0)};a.options=null;a.templates=[];a.allowCustomValue=!0;a.vippsRedirectUrl="";a.authData=l.getAuth();a.departmentPreferences=h.getDepartmentPreferences();i.$on("PaymentDoneEx",function(n,i){console.log("Gift certificate payment complete.");console.log(i);let r=i.GiftCertificates[0].Id,u=i.GiftCertificates[0].NonMonetaryReceiptId;r||(r=i.GiftCertificates[0].id);u||(u=i.GiftCertificates[0].nonMonetaryReceiptId);var f={id:r,nonMonetaryReceiptId:u,invoiceId:i.InvoiceId};s.sendGiftCertificateByEmail(f.id);t.go("giftcertificatedisplay",f)});i.$on("PaymentFailed",function(){u.warning("Betalingen har blitt avbrutt");a.waitingForPayment=!1;i.$apply()});i.$on("PaymentCancelled",function(){u.warning("Vipps payment has been cancelled.");a.waitingForPayment=!1;i.$apply()});a.departmentPreferences.cust2016_GiftCertificatePresets.split(",").map(function(n){a.templates.push({caption:n,value:parseInt(n),"default":!1})});a.setValue=function(n){a.value=n};v=a.templates.find(function(n){return n.default===!0});v&&a.setValue(v.value);a.readyToBuy=function(){return a.value>0};a.handleDialogError=function(n){s.isDialogCloseText(n)?u.error("An error occurred."):u.error("An error occurred: "+n)};a.checkAuthBeforePurchase=function(n){a.authData.isAuth?a.beginPurchase(n):f.displayLoginForm(a.departmentPreferences.cust2016_AllowReservationRule==="true"?null:function(){a.beginPurchase(n)})};a.beginPurchase=function(n){var i={Sender:{CustomerId:0,FirstName:"",LastName:"",Email:""},Recipient:{FirstName:"",LastName:"",Email:""},Amount:n,PaymentMethod:"",Comment:"",VippsPaymentInfo:{TelephoneNumber:"",FallbackUrl:decodeURIComponent(t.href("giftcertificatepurchase",null,{absolute:!0}))}},u=function(){var n=$q.defer();return f.displayGiftCertificateOptions().result.then(function(t){n.resolve(t)},function(){n.reject()}),n.promise},s=function(){var n=$q.defer();return f.displayGiftCertificatePayment().result.then(function(t){n.resolve(t)},function(){n.reject()}),n.promise},h=function(n){var t=$q.defer();return e.beginGiftCertificatePurchase(n).then(function(n){var i=n.transactionId,r={transactionId:i,vippsRedirectUrl:n.vippsRedirectUrl};t.resolve(r)},function(){t.reject("error occurred")}),t.promise};u().then(function(n){i.Recipient=n.recipient;i.Sender=n.sender;i.Comment=n.comment;s().then(function(n){i.PaymentMethod="vipps";i.VippsPaymentInfo.TelephoneNumber=n.vipps.telephoneNumber;var t=i.VippsPaymentInfo.FallbackUrl.lastIndexOf("/");t<i.VippsPaymentInfo.FallbackUrl.length-1&&(i.VippsPaymentInfo.FallbackUrl=i.VippsPaymentInfo.FallbackUrl.substr(0,t+1));h(i).then(function(n){a.waitingForPayment=!0;a.vippsRedirectUrl=n.vippsRedirectUrl;o.subscribeToPaymentHub(n.transactionId);r.location.href=n.vippsRedirectUrl},function(){console.log("step three failed")})},function(){console.log("Canceled at step2")})},function(){console.log("Canceled at step1")})}}n.module("app").controller("giftCertificatePurchaseCtrl",t);t.$inject=["$rootScope","$state","$scope","$window","toastr","ModalService","PurchaseService","SignalService","UtilityService","DepartmentService","transactionId","AuthService"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e){var o=this;o.giftCertificateId=t.params.id;o.giftCertificateImage=null;o.invoiceId=t.params.invoiceId;o.nonMonetaryReceiptId=t.params.nonMonetaryReceiptId;i.getGiftCertificateImageHtml(o.giftCertificateId).then(function(n){o.giftCertificateImage=n.data});o.print=function(){window.print()};o.sendEmail=function(){i.sendGiftCertificateByEmail(o.giftCertificateId).then(function(){e.success("E-post er sendt")},function(){e.error("Error")})};o.showReceiptModal=function(){return r.getNonMonetaryReceiptHtml(o.invoiceId,o.nonMonetaryReceiptId).then(function(n){u.displayReceipt(n.data.receiptHtmlString)},function(){e.error(f.instant("Error_while_downloading_receipt"))})}}n.module("app").controller("giftCertificateDisplayCtrl",t);t.$inject=["$scope","$state","UtilityService","BookingService","ModalService","$translate","toastr"]}(window.angular),function(n){"use strict";function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w=this,b,k,d;w.currentYear=(new Date).getFullYear();w.departmentInfo={};w.googleMapsSrc="";w.emailData={};w.working=!1;w.bookingOptions={displayType:"",selectedDateFrom:new Date,selectedService:null,displayTypesOptions:[],bookingType:"standard",selectedResource:null,availableDatesFromVisibleDates:[],datepickerOptions:{minDate:new Date,maxMode:"day",visibleDates:[],dateDisabled:function(n){var t,i;if(n.mode!=="day"||w.bookingOptions.selectedService===null)return!1;for(t=0;t<w.bookingOptions.availableDatesFromVisibleDates.length;t++)if(i=new Date(w.bookingOptions.availableDatesFromVisibleDates[t]),i.getYear()===n.date.getYear()&&i.getMonth()===n.date.getMonth()&&i.getDate()===n.date.getDate())return!1;return!0}}};w.authData={};w.allServices=[];w.allowedServices=[];w.allResources=[];w.allowedResources=[];w.screenOptions=h.getScreenOptions();r.$watch("hc.bookingOptions.datepickerOptions.visibleDates",function(){if(w.bookingOptions.selectedService!=null&&w.bookingOptions.datepickerOptions.visibleDates.length!==0){var n={services:[w.bookingOptions.selectedService],resource:w.bookingOptions.selectedResource===null?{id:0}:w.bookingOptions.selectedResource,availableResources:w.allowedResources,visibleDates:w.bookingOptions.datepickerOptions.visibleDates,selectedDate:w.bookingOptions.selectedDateFrom,loginid:w.authData.loginid};t.getFreeDatesInDateRange(n).then(function(n){w.bookingOptions.availableDatesFromVisibleDates=n.data;r.$broadcast("refreshDatepickers")}).finally(function(){})}});l.getAllServices().then(function(t){w.allServices=t;w.allowedServices=n.copy(w.allServices);w.allowedServices.length==1&&(w.bookingOptions.selectedService=w.allowedServices[0])});u.getAllResources().then(function(t){w.allResources=t;w.allowedResources=n.copy(w.allResources)});w.departmentInfo=f.getDepartmentInfo();b=w.departmentInfo.address1;k=w.departmentInfo.city;w.departmentInfo.latitude>0&&w.departmentInfo.longitude>0&&(b=w.departmentInfo.latitude,k=w.departmentInfo.longitude);d="https://www.google.com/maps/embed/v1/place?key="+e.googleApiKey+"&q="+b+","+k+"&language="+y.getDatabaseDefaultLanguage();w.googleMapsSrc=o.trustAsResourceUrl(d);w.bookingOptions.displayTypesOptions=h.getDisplayTypesOptions();w.departmentPreferences=f.getDepartmentPreferences();w.departmentNouns=f.getDepartmentNouns();w.authData=a.getAuth();w.bookingOptions.displayType=h.getDefaultDisplayType();w.feedbacks=[{id:0,title:w.departmentPreferences.cust2016_FPFeedback1Title,username:w.departmentPreferences.cust2016_FPFeedback1Username,website:w.departmentPreferences.cust2016_FPFeedback1Website,text:w.departmentPreferences.cust2016_FPFeedback1Text,imageUrl:w.departmentPreferences.cust2016_FPFeedback1Imageurl},{id:1,title:w.departmentPreferences.cust2016_FPFeedback2Title,username:w.departmentPreferences.cust2016_FPFeedback2Username,website:w.departmentPreferences.cust2016_FPFeedback2Website,text:w.departmentPreferences.cust2016_FPFeedback2Text,imageUrl:w.departmentPreferences.cust2016_FPFeedback2Imageurl},{id:2,title:w.departmentPreferences.cust2016_FPFeedback3Title,username:w.departmentPreferences.cust2016_FPFeedback3Username,website:w.departmentPreferences.cust2016_FPFeedback3Website,text:w.departmentPreferences.cust2016_FPFeedback3Text,imageUrl:w.departmentPreferences.cust2016_FPFeedback3Imageurl}];w.changedSelectedResource=function(){w.allowedServices=l.getServicesForResource(w.bookingOptions.selectedResource,w.allServices)};w.changedSelectedService=function(){w.allowedResources=u.getResourcesForService(w.bookingOptions.selectedService,w.allResources)};v(function(){r.$apply(function(){w.departmentPreferences.cust2016_SearchShowServiceFirst==="true"?($('.sortable-serice-resource-home>div[data-name="service"]').data("index",1),$('.sortable-serice-resource-home>div[data-name="resource"]').data("index",2)):($('div.sortable-serice-resource-home>div[data-name="service"]').data("index",2),$('div.sortable-serice-resource-home>div[data-name="resource"]').data("index",1));$(".sortable-serice-resource-home").each(function(){var n=$(this);n.append(n.find("div[data-name]").get().sort(function(n,t){return $(n).data("index")-$(t).data("index")}))})})});w.departmentPreferences.cust2016_EnableVippsLogin!=="true"||a.getAuth().isAuth||p.performVippsLogin(w.departmentPreferences.cust2016_AllowReservationRule);w.openCalendarFrom=function(){w.openedCalendarFrom=!0};w.sendEmail=function(){w.working=!0;h.sendEmail(w.emailData).then(function(){c.success("Email sent!");w.emailData={}},function(){c.error("Error sending email!")}).finally(function(){w.working=!1})};w.searchBookings=function(){var n={searchType:"standard",serviceId:w.bookingOptions.selectedService.id,displayType:w.bookingOptions.displayType,isCombined:w.bookingOptions.selectedService.isCombined,startDate:w.bookingOptions.selectedDateFrom,resourceId:w.bookingOptions.selectedResource===null?undefined:w.bookingOptions.selectedResource.id};s.go("booking",n)};w.searchBookingsWithWizardSearchOrderAll=function(n){var t={wizardOrder:n};s.go("booking",t)};w.getFrontPageIconClass=function(n){var t=["fa","fa-2x","lead","text-primary"];return n===1?w.departmentPreferences.cust2016_FPLine1Icon&&t.push(w.departmentPreferences.cust2016_FPLine1Icon):n===2?w.departmentPreferences.cust2016_FPLine2Icon&&t.push(w.departmentPreferences.cust2016_FPLine2Icon):n===3&&w.departmentPreferences.cust2016_FPLine3Icon&&t.push(w.departmentPreferences.cust2016_FPLine3Icon),t}}n.module("app").controller("homeCtrl",t);t.$inject=["BookingService","$translate","$scope","ResourceService","DepartmentService","CONST","$sce","$state","UtilityService","toastr","ServiceService","AuthService","$timeout","LanguageService","ExternalLoginService","$location","ModalService"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c,l,a){var v=this,y;v.currentYear=(new Date).getFullYear();v.customizedCookie=!1;v.saveTechCookie=!0;v.saveAnalyticsCookie=!0;v.websiteColorScheme={color:"",themeColorList:[]};v.screenOptions=s.getScreenOptions();v.iframeUrl="";v.departmentInfo=u.getDepartmentInfo();v.departmentPreferences=u.getDepartmentPreferences();v.websiteColorScheme=s.getWebsiteColorScheme();v.authData=h.getAuth();y=c.getNikitaSettings();v.iframeUrl=e.trustAsResourceUrl(y.iframeUrl);v.getHanoFooterInfo=function(){var n=v.departmentInfo.languageId;return n===2?{text:"Lösningen är levererad av",url:"https://eg.se/it/eg-hano-journalsystem/",largeImage:"images/eg-hano-logo.svg",smallImage:"images/eg-hano-logo.svg"}:{text:"Løsningen er levert av",url:"https://eg.no/it/eg-hano/",largeImage:"images/eg-hano-logo.svg",smallImage:"images/eg-hano-logo.svg"}};v.iframeLoadedCallBack=function(){y.isNikita&&c.getAndSetAccessTokenFromUserPages()};v.getWebsiteColorSchemeUrl=function(){var n=v.websiteColorScheme.color;return n==="ontime"?"bootstrap-less/bootstrap.less":"bootstrap-color-themes/bootstrap-"+n+".css"};v.getWebsiteFavicon=function(){return v.departmentPreferences.cust2016_FaviconUrl.trim().length>0?v.departmentPreferences.cust2016_FaviconUrl:rootApplicationURL+"/Images/favicon.ico"};v.showFooter=function(){var n=o.current.name;return n==="booking"||n==="mandatoryLogin"?!1:!0};v.showNavigationBar=function(){var n=!1,i=o.current.name,t;v.authData.isAuth?n=!0:v.departmentPreferences.cust2016_mandatoryLogin==="false"&&(n=v.departmentPreferences.cust2016_ViewCustLogin==="true"&&i==="mandatoryLogin"?!1:!0);t=!1;try{t=window.location!=window.parent.location;n&&t&&v.departmentPreferences.cust2016_ShowNavBarInIFrame==="false"&&(n=!1)}catch(r){}return n};v.showCookiebanner=function(){var i,t;if(!v.departmentPreferences.cust2016_EnableGoogleTracking||v.departmentPreferences.cust2016_DeactivateCookieBanner=="true")return!1;if(i=!0,t=l.getObject("HanoCookieConsentInforNew"),t!==null&&t!==undefined){var n=JSON.parse(t),r=a.host(),u=a.protocol(),f=u+"://"+r;n&&n.type&&n.url&&f==n.url&&(n.type=="all"||n.type=="custom")&&(i=!1)}return i};v.customizeCookie=function(){v.customizedCookie=!0};v.acceptCookie=function(n){l.remove("HanoCookieConsentInforNew");var i=a.host(),r=a.protocol(),u={type:n,url:r+"://"+i},t=new Date,f=new Date(t.getFullYear()+1,t.getMonth(),t.getDate()),e={expires:f,secure:!0,path:"/"};l.putObject("HanoCookieConsentInforNew",JSON.stringify(u),e);n=="all"?gtag("consent","update",{analytics_storage:"granted",ad_storage:"granted",ad_user_data:"granted",ad_personalization:"granted"}):gtag("consent","update",{analytics_storage:"denied",ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied"})};v.saveCustomizedCookie=function(){v.saveAnalyticsCookie?v.acceptCookie("all"):v.acceptCookie("custom")}}n.module("app").controller("indexCtrl",t);t.$inject=["$timeout","$translate","$scope","ResourceService","DepartmentService","CONST","$sce","$state","UtilityService","AuthService","NikitaService","$cookies","$location"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e){var s=this,o;s.htmlSnippet="";o=n.bookingItems;s.$onInit=function(){o.klarnaCheckoutOrder={confirmationUrl:decodeURIComponent(t.href("klarnaconfirmation",{id:"{checkout.order.id}"},{absolute:!0})),termsUrl:t.href("klarnaterms",null,{absolute:!0}),checkoutUrl:t.href("booking",null,{absolute:!0}),paymentOnSiteUrl:t.href("klarnaexternalpay",{id:e.noPaymentMethod},{absolute:!0})};var n=function(n){console.log("back from the api...",n);n.data.klarnaConfirmationSnippet&&(s.htmlSnippet=n.data.klarnaConfirmationSnippet);u.saveBookingInfoInStorage(o)},h=function(){r.error(f.instant("Error_while_booking_services"))};i.createBooking(o,n,h)}}n.module("app").controller("klarnaCheckoutController",t);t.$inject=["$stateParams","$state","PurchaseService","toastr","UtilityService","$translate","CONST"]}(window.angular),function(n){"use strict";function t(n,t){var i=this;i.confirmationSnippet=n;t.empty()}n.module("app").controller("klarnaConfirmationCtrl",t);t.$inject=["confirmationSnippet","ngCart"]}(window.angular),function(n){"use strict";function t(t,i,r,u,f,e,o,s,h,c){var l=this;l.bookingInProgress=!0;l.bookingFail=!1;l.bookingSuccess=!1;l.postRequestActivity={};l.departmentNouns=c.getDepartmentNouns();l.$onInit=function(){var c=n.element($("#klarna-fullscreen-iframe")),a,i,v,y;if(c.length>0&&(c[0].style.display="none"),a=s.getAuth().isAuth,!a)return o.displayLoginForm(l.checkout),null;i=e.getBookingInfoFromStorage();i.paymentMethod=t;l.postRequestActivity=i;v=function(){l.bookingInProgress=!1;l.bookingSuccess=!0;e.clearBookingInfoFromStorage();h.empty()};y=function(){u.error(f.instant("Error_while_booking_services"));l.bookingInProgress=!1;l.bookingFail=!0};r.createBooking(i,v,y)};l.navigateHome=function(){i.go("home")}}n.module("app").controller("klarnaExternalPayCtrl",t);t.$inject=["paymentMethod","$state","PurchaseService","toastr","$translate","UtilityService","ModalService","AuthService","ngCart","DepartmentService"]}(window.angular),function(n){"use strict";function t(n){var t=this;t.terms=n}n.module("app").controller("klarnaTermsCtrl",t);t.$inject=["terms"]}(window.angular),function(n){"use strict";function t(n,t,i){var r=this;r.departmentInfo={};r.departmentPreferences={};t.displayLoginForm();r.departmentInfo=i.getDepartmentInfo();r.departmentPreferences=i.getDepartmentPreferences();r.displayLoginForm=function(){t.displayLoginForm()}}n.module("app").controller("mandatoryLoginCtrl",t);t.$inject=["$scope","ModalService","DepartmentService"]}(window.angular),function(n){"use strict";function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){var k=this;k.allResources=[];k.allServices=[];k.closedNavbar=!0;k.authData={};k.linkedDatabases=[];k.chainedDatabases=[];k.screenOptions=null;k.departmentInfo=null;k.departmentPreferences=y.getDepartmentPreferences();k.authData=a.getAuth();k.departmentPreferences=y.getDepartmentPreferences();k.departmentNouns=y.getDepartmentNouns();k.departmentInfo=y.getDepartmentInfo();c.getAllResources(!0).then(function(n){k.allResources=n});l.getAllServices().then(function(t){k.allServices=t;var r=[];k.servicesWithoutServiceGroup=[];i.getAllServiceGroups().then(function(t){var i,u;for(k.allServiceGroupsWithServices=t,i=0;i<k.allServiceGroupsWithServices.length;i++)u=l.getServicesForServiceGroup(k.allServiceGroupsWithServices[i],k.allServices),k.allServiceGroupsWithServices[i].services=u,n.forEach(u,function(n){r.push(n)});n.forEach(k.allServices,function(n){var t=r.filter(function(t){return t.id===n.id});t.length===0&&k.servicesWithoutServiceGroup.push(n)})})});y.getLinkedDatabases().then(function(n){k.linkedDatabases=n.data});y.GetChainedDatabasesWithSharedCustomerRegister().then(function(n){k.chainedDatabases=n.data});k.screenOptions=w.getScreenOptions();k.changeDatabase=function(n){var i=w.getCurrentDomain(),u=k.chainedDatabases.indexOf(n.name)===-1?!1:!0,t,r;u&&(t=a.getAuthorizationDataLocalStorage(),t!==null&&p.putObject("authorizationData",t,{domain:i,path:"/"}));r=n.alias&&n.alias.length>0?w.getCurrentProtocol()+"://"+n.alias+rootApplicationURL:w.getCurrentProtocol()+"://"+n.name+i+rootApplicationURL;b.location.href=r};k.getTotalCountInCart=function(){return h.getTotalItems()};k.closeNavbar=function(n){if(n==="home"&&e.current.name==="home"){var t=k.departmentPreferences.cust2016_UrlToGoWhenFrontPageLogoClicked;t&&t.length>0&&(b.location.href=t)}n!==undefined&&e.transitionTo(n,{},{reload:!0,inherit:!1,notify:!0});k.closedNavbar=!0};k.authChangeState=function(n,t){k.authData.isAuth?k.closeNavbar(n):v.displayLoginForm(function(){k.authChangeState(n,t)})};k.logout=function(){t.removeAccessTokenFromUserPages();a.logout()};k.displayLoginForm=function(){v.displayLoginForm()};k.displayResourceInformation=function(n){v.displayResourceInformation(n)};k.displayServicesInformation=function(n){v.displayServicesInformation(n)};k.getBrandImageStyle=function(){var n={height:""};return n.maxHeight=k.screenOptions.navbarHeight+"px",n.maxWidth="100%",n};k.getBrandAnchorStyle=function(){var n={padding:""};return n.padding="0 15px",k.screenOptions.isSmallScreen&&(n.maxWidth="70%"),n}}n.module("app").controller("navbarCtrl",t);t.$inject=["NikitaService","ServiceGroupService","toastr","$scope","$translate","$state","$aside","$uibModal","ngCart","ResourceService","ServiceService","AuthService","ModalService","DepartmentService","$cookies","UtilityService","$window"]}(window.angular),function(n){"use strict";function t(){var n=this}n.module("app").controller("notFound404Ctrl",t);t.$inject=[]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e){var o=this,s=10;o.rootProductGroup=[];o.productsForSelectedGroup=[];o.currentPage=1;o.currentPageFromPagination=1;o.itemsPerPage=10;o.working=!0;o.my_tree={};o.searchTerm="";o.sortType="name";o.sortReverse=!1;o.filteredDataWithoutSearchTerm=[];o.filteredDataWithSearchTerm=[];o.filteredProductsBySearchTerm=[];o.departmentPreferences={};i.getProductGroupTree().then(function(n){o.rootProductGroup.push(n);o.my_tree.select_first_branch();o.my_tree.expand_branch()});o.departmentPreferences=e.getDepartmentPreferences();o.getMaxQtyForItem=function(n){for(var i=o.getProductFromCart(n),u=i!==!1&&i._quantity>s?i._quantity:s,r=[],t=0;t<u;t++)r[t]=t+1;return r};o.getProductQuantity=function(n){var t=o.getProductFromCart(n);return t===!1?1:t._quantity};o.addItemToCart=function(t){var i=0;o.departmentPreferences.cust2016_ShowProductPrice==="true"&&(i=t.price);n.addItem(t.id,t.name,i,t.quantity,{product:!0})};o.getProductFromCart=function(t){return n.getItemById(t.id)};o.removeProductFromCart=function(t){n.removeItemById(t.id)};o.getCart=function(){return n.getCart()};o.loadProductsForThisGroup=function(n){o.working=!0;o.searchTerm="";i.getProductGroup(n.id).then(function(n){o.productsForSelectedGroup=n.productGroup.products}).finally(function(){o.working=!1})};o.changedPaginationPage=function(){$("#productsTable").fadeOut(function(){o.currentPage=o.currentPageFromPagination;r.$apply();$("#productsTable").fadeIn()})};o.searchProductsByName=function(){o.searchTerm.length!==0&&(o.working=!0,i.searchProductsByName(o.searchTerm).then(function(n){for(var t,u=n.data,i={},r=0;r<u.length;r++)t=u[r].productGroup,t=t===null?"#":t.name,i[t]||(i[t]={},i[t].groupName=t,i[t].products=[]),i[t].products.push(u[r]);o.filteredDataWithSearchTerm=i}).finally(function(){o.working=!1}))};o.displayProductInfoModal=function(n){var t=f.displayProductInfo(n)}}n.module("app").controller("productsCtrl",t);t.$inject=["ngCart","toastr","ProductGroupService","$scope","$filter","ModalService","DepartmentService"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o){var s=this;s.ngCart=n;s.working=!1;s.tooltipSelectedService={};s.departmentNouns=e.getDepartmentNouns();s.departmentPreferences=e.getDepartmentPreferences();s.checkout=function(){var h=u.getAuth().isAuth,e,n,o,r;if(!h)return f.displayLoginForm(s.checkout),null;if(e=i.getBookingObjFromShoppingCart(),n=i.getProductsFromShoppingCart(),n.length>0&&e.length<=0){for(o=[],r=0;r<n.length;r++)o.push({productId:n[r]._id,quantity:n[r]._quantity});t.createBookingOnlyProduct({customerId:0,products:o})}else f.displayConfirmPurchase(e,n)};s.updateTooltipService=function(n){s.tooltipSelectedService=n};s.clearShoppingCart=function(){n.empty()};o.$on("OrderProductsDone",function(t,r){var u=[];r.data.hasEmailSent||u.push("Feil ved sending e-post!");f.displayPurchaseCompleted([],i.getProductsFromShoppingCart(),u,"",0);n.empty()})}n.module("app").controller("shoppingCartCtrl",t);t.$inject=["ngCart","BookingService","UtilityService","toastr","AuthService","ModalService","DepartmentService","$scope"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){var it=this,et,n,ut,rt,ft;for(it.departmentInfo={},it.themeColorList=[],it.customerScheme={},it.authData={},it.externalProviderAlreadyMerged=!1,it.working=!1,it.newPassword="",it.repeatNewPassword="",it.changingPassword=!1,it.passwordRegex="",it.passwordRegexMessage="",it.bookingHistory=[],it.productHistory=[],it.bookingFuture=[],it.bookingHistoryPaginationData={pageNumber:1,pageSize:10,totalPages:1},it.productHistoryPaginationData={pageNumber:1,pageSize:10,totalPages:1},it.languageOptions=[],it.sortType="starts",it.personalSettings={websiteColorTheme:"",timeplanOrientation:"",choosenLanguageCode:""},it.websiteColorScheme={color:"",themeColorList:[]},it.timeplanOrientationOptions=[],it.setAsComplimentUser=!1,it.countries=[],it.smsCountryId=n.smsCountryId,it.customerGroupId=null,it.bonusPointBalance=0,et=o.bookingItems,it.complimentTermsUrl=t.getComplimentTermsUrl(),it.nikitaSettings=t.getNikitaSettings(),it.departmentInfo=h.getDepartmentInfo(),h.getSelectedCountries().then(function(n){it.countries=n;it.smsCountryId=it.departmentInfo.languageId;w.$broadcast("getSelectedCountry",it.countries,it.smsCountryId)}),it.passwordRegex=k.getPasswordStrengthRegex(),it.passwordRegexMessage=k.getPasswordStrengthRegexMessage(),it.active=["account","pendingBookings","bookingHistory","productHistory","waitList"].indexOf(o.tabName)===-1?"account":o.tabName,r.getWaitListByCustomer().then(function(n){it.waitList=n.data}),i.checkIfConnectedCustomerIdToExternalId().then(function(n){it.externalProviderAlreadyMerged=n.data}),it.websiteColorScheme=k.getWebsiteColorScheme(),it.timeplanOrientationOptions=k.getTimeplanOrientationOptions(),it.languageOptions=e.getLanguageOptions(),it.personalSettings.websiteColorTheme=it.websiteColorScheme.color,it.personalSettings.timeplanOrientation=k.getTimeplanOrientation(),it.personalSettings.choosenLanguageCode=e.getLanguageFromLocalStorage(),it.authData=l.getAuth(),it.departmentPreferences=h.getDepartmentPreferences(),it.departmentNouns=h.getDepartmentNouns(),it.canSetCustomerGroup=it.departmentPreferences.cust2016_AllowReservationRule=="true"&&it.departmentPreferences.custAllowSetLoginGroup=="true",it.userMustSelectGroup=it.canSetCustomerGroup&&it.departmentPreferences.customerMustSelectLoginGroup=="true",it.showBonusPoints=it.departmentPreferences.useBonusPoints==="true",it.showBonusPoints&&tt.getPointBalance().then(function(n){var t=n.data;console.log("bonus point balance is "+t.current);it.bonusPointBalance=t.current},function(){console.log("unable to fetch bonus point balance")}),v.getCustomerProductHistory(it.productHistoryPaginationData.pageNumber,it.productHistoryPaginationData.pageSize).then(function(n){it.productHistory=n.data.items;it.productHistoryPaginationData.totalPages=n.data.pageCount}),v.getCustomerHistoryBookings(it.bookingHistoryPaginationData.pageNumber,it.bookingHistoryPaginationData.pageSize).then(function(n){it.bookingHistory=n.data.bookingHistory;it.bookingHistoryPaginationData.totalPages=n.data.totalPages}),v.getCustomerFutureBookings().then(function(n){it.bookingFuture=n.data}),it.customerGroup=n.groupId!=null?{id:n.groupId}:null,it.replaceTranslations=function(n,t,i){return n?f.instant(n).replace(t,i):n},it.customerScheme=nt,n=n,ut=Object.keys(n.fields),rt=0;rt<ut.length;rt++)for(ft=0;ft<it.customerScheme.length;ft++)it.customerScheme[ft].name.toLowerCase()===ut[rt].toLowerCase()&&(it.customerScheme[ft].value=it.customerScheme[ft].type==="Date"?n.fields[ut[rt]]!==""?new Date(n.fields[ut[rt]]):"":it.customerScheme[ft].type==="Integer"?parseInt(n.fields[ut[rt]]):n.fields[ut[rt]]);it.nikitaSettings.isNikita&&v.getComplimentUser().then(function(n){it.complimentUser=n.data;it.setAsComplimentUser=!0},function(){it.complimentUser=null});it.showFeedbackModal=function(n){var t=c.showFeedbackModal(n)};it.getOptionsTextFromField=function(n){for(var t=0;t<n.options.length;t++)if(n.options[t].value===n.value)return n.options[t].text;return n.value};it.changedBookingPaginationPage=function(){v.getCustomerHistoryBookings(it.bookingHistoryPaginationData.pageNumber,it.bookingHistoryPaginationData.pageSize).then(function(n){$("#bookingHistoryTable").fadeOut(function(){it.bookingHistory=n.data.bookingHistory;it.bookingHistoryPaginationData.totalPages=n.data.totalPages;w.$apply();$("#bookingHistoryTable").fadeIn()})})};it.changedProductPaginationPage=function(){v.getCustomerProductHistory(it.productHistoryPaginationData.pageNumber,it.productHistoryPaginationData.pageSize).then(function(n){$("#productHistoryTable").fadeOut(function(){it.productHistory=n.data.items;it.productHistoryPaginationData.totalPages=n.data.pageCount;w.$apply();$("#productHistoryTable").fadeIn()})})};it.cancelBooking=function(n){var t=c.displayActivityInfoModal(n);t.result.then(function(t){var i,r;if(t.method==="removeFutureBooking")it.bookingFuture.splice(it.bookingFuture.indexOf(n),1);else if(t.method==="removeFutureCombinedBooking")for(i=0;i<n.connectedActivities.length;i++)r=u("getById")(it.bookingFuture,n.id),it.bookingFuture.splice(it.bookingFuture.indexOf(r),1)})};it.savePersonalSettings=function(){it.working=!0;p(function(){k.setWebsiteColorTheme(it.personalSettings.websiteColorTheme);k.setTimeplanOrientation(it.personalSettings.timeplanOrientation);e.setLanguageLocalStorage(it.personalSettings.choosenLanguageCode);e.setLocalizationCode();a.success("Saved!");it.working=!1},1e3)};it.updateCustomerFields=function(n){it.working=!0;p(function(){for(var u,t,r={fields:{},password:"",smsCountryId:it.smsCountryId,groupId:it.customerGroup!=null?it.customerGroup.id:null},i=0;i<it.customerScheme.length;i++)u=it.customerScheme[i].name,t=it.customerScheme[i].value,r.fields[u]=it.customerScheme[i].type=="Date"&&t!=undefined&&t!=null&&t!=""?t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate():t;if(it.changingPassword===!0){if(it.newPassword!==it.repeatNewPassword){a.error("Passwords do not match!");it.working=!1;return}r.password=it.newPassword}v.getDuplicatedCustomerFieldsForRegisteredUser(r.fields).then(function(t){var u=t.data,i;if(u.length>0&&!n){i=it.departmentInfo.phone1?it.departmentInfo.phone1:it.departmentInfo.phone2;alert(f.instant("User_with_this_fields_already_exists")+" "+u+". \n"+(i?f.instant("Contact")+": "+i:""));it.working=!1;return}v.updateCustomerFields(r).then(function(){a.success("Customer info updated");it.newPassword="";it.repeatNewPassword="";it.changingPassword=!1;it.nikitaSettings.isNikita&&v.updateComplimentUser(it.setAsComplimentUser).then(function(){a.success("Compliment user updated");v.getComplimentUser().then(function(n){it.complimentUser=n.data;it.setAsComplimentUser=!0},function(){it.complimentUser=null})},function(){a.error("Error while updating compliment user")});et!=null&&c.displayConfirmPurchase(et.onlyBookingItems,et.onlyProductItems,et.requireResource)},function(){a.error("Error!")}).finally(function(){it.working=!1})})},1500)};it.changedTab=function(n){g.transitionTo("userAccount",{tabName:n},{notify:!1})};it.checkCannotBeCanceled=function(n){return it.departmentPreferences.cust2016_CancelAppointment==="true"?new Date(n.canCancelBefore)<new Date?!0:!1:!0};it.displayWaitListInfoModal=function(){var n=c.displayWaitListInfoModal();n.result.then(function(){r.getWaitListByCustomer().then(function(n){it.waitList=n.data})})};it.deleteWaitListItem=function(n){confirm(f.instant("Remove")+"?")&&r.deleteWaitListItem(n.id).then(function(){a.success(f.instant("Removed"));it.waitList.splice(it.waitList.indexOf(n),1)})};it.linkCustomerIdToExternalId=function(){confirm(f.instant("Link_facebook_to_this_account")+"?")&&FB.login(function(n){n.authResponse?i.linkCustomerIdToExternalId(n.authResponse.accessToken).then(function(){a.success(f.instant("Link"));it.externalProviderAlreadyMerged=!0}):console.log("User cancelled login or did not fully authorize.")})};it.unlinkCustomerIdFromExternalId=function(){confirm(f.instant("Unlink_facebook_login_from_this_account")+"?")&&i.unlinkCustomerIdFromExternalId().then(function(){a.success(f.instant("Unlink"));it.externalProviderAlreadyMerged=!1})};it.deleteUser=function(){confirm(f.instant("Confirm_delete_account"))&&(it.working=!0,v.deleteUser().then(function(n){n.data&&n.data.success===!1?a.error(n.data.message):(a.success(n.data.message),l.logout())},function(n){a.error(f.instant("Failed_to_delete_account")+(n.data&&n.data.Message?n.data.Message:f.instant("Unknown_error")))}).finally(function(){it.working=!1}))}}n.module("app").controller("userAccountCtrl",t);t.$inject=["customer","NikitaService","ExternalLoginService","WaitListService","$filter","$translate","LanguageService","$stateParams","$window","DepartmentService","ModalService","AuthService","toastr","UserAccountService","$uibModal","$timeout","$scope","CONST","UtilityService","BookingService","$state","customerScheme","BonusPointService"]}(window.angular),function(n){"use strict";function t(n,t,i,r,u,f,e,o,s,h,c){var l=this;l.inProgress=!0;l.bookingSuccess=!1;l.bookingFail=!1;l.bookingCancelled=!1;l.departmentNouns=f.getDepartmentNouns();l.departmentPreferences=f.getDepartmentPreferences();l.departmentInfo=f.getDepartmentInfo();l.onlyBookingItems=[];l.onlyProductItems=[];l.invoiceId=null;l.$onInit=function(){var n=s.getAuth().isAuth;if(!n){i.displayLoginForm(l.checkout);return}l.onlyProductItems=e.getProductsFromLocalStorage();l.onlyBookingItems=e.getServicesFromLocalStorage();console.log("fallback loading...")};n.$on("PaymentDone",function(t,i,r){l.inProgress=!1;l.bookingSuccess=!0;l.invoiceId=r;n.$digest();e.removeProductsAndServices();o.empty()});n.$on("PaymentFailed",function(){l.inProgress=!1;l.bookingFail=!0;r.error(u.instant("Error_while_booking_services"));e.removeProductsAndServices();o.empty();n.$digest()});n.$on("PaymentCancelled",function(){l.inProgress=!1;l.bookingCancelled=!0;r.warning(u.instant("Payment_cancelled"));e.removeProductsAndServices();o.empty()});l.navigateHome=function(){l.departmentPreferences.cust2016_RedirectUrlAfterConfirmation!==""?c.location=l.departmentPreferences.cust2016_RedirectUrlAfterConfirmation:t.go("home")};l.backToSearch=function(){t.go("booking")};l.showReceiptModal=function(){return h.getReceiptHtml(l.invoiceId).then(function(n){i.displayReceipt(n.data.receiptHtmlString)},function(){r.error(u.instant("Error_while_downloading_receipt"))})}}n.module("app").controller("vippsFallbackCtrl",t);t.$inject=["$scope","$state","ModalService","toastr","$translate","DepartmentService","UtilityService","ngCart","AuthService","BookingService","$window"]}(window.angular)